<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="format-detection" content="telephone=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<title>API</title>
<script type="text/javascript"> 
	(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=[].slice,G={}.hasOwnProperty,H=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};for(y=this,a=function(b){return b instanceof a?b:this instanceof a?void(this._wrapped=b):new a(b)},a.now=function(){return(Date.now||function(){return(new Date).getTime()})()},a.script_time=a.now(),C=0,a.CRLF="\r\n",B=a,r={log:1,info:2,warn:3,error:4,none:5},f={c:!1},t={ctxPath:"",basePath:"",logger:r.log,toStringEvent:!1,toStringShowType:!0,logPrefix:function(b){return">> "+b+" ["+a.when.log()+"]"},dateMask:{"default":"yyyy-mm-dd HH:MM:ss",log:"yyyy-mm-dd HH:MM:ss l",day:"yyyy-mm-dd",time:"HH:MM:ss",week:"dddd"},dateI18n:{day:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]}},c=Array.prototype.forEach,b=Array.prototype.filter,e=!1,m=encodeURIComponent,a.each=function(b,d,f){var g,h,i,j,k,l;if(null===b)return b;if(c&&b.forEach===c)b.forEach(d,f);else if(b.length===+b.length)for(g=0,k=b.length;;){if(k>g||d.call(f,b[g],g,b)===e)break;g++}else for(j=a.keys(b),h=0,l=j.length;l>h;h++)if(i=j[h],d.call(f,b[i],i,b)===e)return;return b},a.filter=function(c,d,e){var f;return f=[],null===c?f:b&&c.filter===b?c.filter(d,e):(a.each(c,function(a,b,c){d.call(e,a,b,c)&&f.push({index:a})}),f)},a.extend=function(b){return a.each(a.slice(arguments,1),function(a){var c;if(a)for(c in a)b[c]=a[c]}),b},a.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},l=function(b,c,d,e){return function(c){return b[e?e+a.capitalize(c):c]=d}(c)},a.type=function(a,b){var c;return null==b&&(b=!1),c=Object.prototype.toString.call(a),b?c:c.slice(8,-1)},i=["Arguments","Array","Boolean","Date","Error","Function","Null","Number","Object","RegExp","String","Undefined","global"],d=function(b){return l(B,b,function(c){return b===a.type(c)},"is")},o=0,q=i.length;q>o;o++)D=i[o],d(D);a.isFunc=a.isFunction,a.isWin=a.isGlobal,a.isJson=function(b){return"object"==typeof b&&a.isObject(b)&&!b.length},a.isEvent=function(b){return!(a.isNull(b)||a.isUndefined(b)||a.isUndefined(b.altKey)&&a.isUndefined(b.preventDefault))},a.isBlank=function(){var b,c,d,e,f;if(c=arguments[0],f=2<=arguments.length?F.call(arguments,1):[],c=a.isString(c)?a.trim(c):c,null!=f)for(d=0,b=f.length;b>d;d++)if(e=f[d],e===c)return!0;return a.isNull(c)||a.isUndefined(c)||a.isString(c)&&c.length<1||a.isJson(c)&&a.keys(c).length<1?!0:!1},a.isPlainObject=function(b){return a.isObject(b)&&!a.isWin(b)&&Object.getPrototypeOf(b)===Object.prototype},n=function(b,c,d){var e;e=d||B,l(e,b,function(){return a.isFunc(t[b])?t[b].apply(this,arguments):t[b]},"get"),l(e,b,function(a){return t[b]=a},"set"),t[b]=c},a.getset=function(b,c){var d,e,f,g,h,i;if(g={},a.isString(b))g[b]=null;else if(a.isArray(b))for(d=h=0,f=b.length;f>h;d=++h)i=b[d],g[i]=null;else{if(!a.isJson(b))throw new Error(a.type(arguments)+" is unsupported, must string|string array|JSON");g=b}for(e in g)i=g[e],n(e,i,c)},a.getset(t),a.getset(f,f),a.settings=function(){return t},a.clone=function(b){return a.isObject(b)?a.isArray(b)?b.slice():a.extend({},b):b},z=function(b,c,d,e){var f,g;f=a.isArray(c),g=a.isPlainObject(c),a.each(c,function(c,h){var j;j=a.type(c),e&&(h=d?e:e+"["+(g||j===i[8]||j===i[1]?h:"")+"]"),!e&&f?b.add(c.name,c.value):j===i[1]||!d&&j===i[8]?z(b,c,d,h):b.add(h,c)})},a.param=function(a,b){var c;return c=[],c.add=function(a,b){return this.push(m(a)+"="+m(b))},z(c,a,b),c.join("&").replace(/%20/g,"+")},a.getUrl=function(b,c){var d;return d=a.isBlank(c)?"":"?"+(a.isJson(c)?a.param(c):String(c)),/^http/.test(b)?b+d:a.getBasePath()+a.aroundIf(a.getCtxPath(),"/")+b+d},a.getUrlVars=function(){var a,b,c,d,e,f,g,h;if(h={},b=y.location.href,c=b.indexOf("?"),-1===c)return h;for(f=b.slice(c+1).split("&"),e=0,d=f.length;d>e;e++)g=f[e],a=g.split("="),h[a[0]]=a[1];return h},a.href=function(b,c){y.location.href=a.getUrl(b,c)},a.slice=function(b,c){return a.isArguments(b)?Array.prototype.slice.call(b,c):(b||[]).slice(c||0)},a.startWith=function(b,c){return new RegExp("^"+(a.isArray(c)?"["+c.join("|")+"]":c)).test(b)},a.endWith=function(b,c){return new RegExp((a.isArray(c)?"["+c.join("|")+"]":c)+"$").test(b)},a.startIf=function(b,c){return a.startWith(b,c)?b:c+b},a.endIf=function(b,c){return a.endWith(b,c)?b:b+c},a.aroundWith=function(b,c){return a.startWith(b,c)&&a.endWith(b,c)},a.aroundIf=function(b,c){return a.endIf(a.startIf(b,c),c)},a.prefix=function(a,b,c){return(Array(b).join(c||"0")+a).slice(-b)},a.suffix=function(a,b,c){return a+Array(b+1).join(c||"0").slice(a.length)},a.trim=function(b,c){return a.isString(b)?a.isUndefined(c)?b.replace(/(^\s*)|(\s*$)/g,""):b.replace(new RegExp("(^("+c+")*)|(("+c+")*$)","gi"),""):b},a.repeat=function(a,b){return new Array(1+b).join(a)},a.ltrim=function(b,c){return a.isString(b)?b.replace(new RegExp("(^"+(a.isBlank(c)?"\\s":c)+"*)"),""):b},a.rtrim=function(b,c){return a.isString(b)?b.replace(new RegExp("("+(a.isBlank(c)?"\\s":c)+"*$)"),""):b},a.randomStr=function(a){var b;for(b="";;)if(b+=Math.random().toString(36).substr(2),b.length>=a)break;return b.substr(0,a)},a.uniqueId=function(a){var b;return b=++C+"",a?a+b:b},a.times=function(a,b,c){var d,e;for(d=Array(Math.max(0,a)),e=0;;)if(d[e]=b.call(c,e),++e,e>=a)break;return d},a.delay=function(b,c){var d;return d=a.slice(arguments,2),setTimeout(function(){return b.apply(null,d)},c)},a.once=function(a){var b,c;return c=!1,b=null,function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},a.wrap=function(a,b){return function(){var c;return c=[a],Array.prototype.push.apply(c,arguments),b.apply(this,c)}},a.prop=function(a){return function(b){return b[a]}},a.format=function(b,c){return a.isArray(c)||(c=a.slice(arguments,1)),b.replace(/\{(\d+)\}/gm,function(b,d){var e;return e=c[d]||b,a.isObject(e)?g(e):e})},v=function(b,c){var d,e,f;if(a.isArray(b))d=b.indexOf(c),d>-1&&b.splice(d,1);else if(a.isJson(b))for(e in b)f=b[e],f===c&&delete b[e]},a.rmByVal=function(){var a,b,c,d,e;for(d=arguments[0],a=2<=arguments.length?F.call(arguments,1):[],c=0,b=a.length;b>c;c++)e=a[c],v(d,e);return d},a.getKey=function(a,b){var c,d;for(c in a)if(G.call(a,c)&&(d=a[c],d===b))return c;return null},a.has=function(b,c){return a.isBlank(b)?!1:a.isArray(b)?H.call(b,c)>=0:a.isObject(b)?c in b:Object.prototype.hasOwnProperty.call(b,c)},a.sleep=function(b){var c,d;for(d=a.now(),c=-1;;)if(c++,a.now()-d>=b)break},a.betn=function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o;if(a.isBlank(c)||a.isBlank(d))return b;if(m=new Array,j=new RegExp("(?:\\"+c+")([\\s\\S]*?)(?:"+d+")","gim"),g=b.match(j),e){for(o=h=0,k=g.length-1;k>=0?k>=h:h>=k;o=k>=0?++h:--h)m.push(g[o]);return m}if(n=null,a.isNull(g))return m;for(f=i=0,l=g.length-1;l>=0?l>=i:i>=l;f=l>=0?++i:--i)n=j.exec(b),a.isNull(n)||m.push(n[1]);return m},a.betns=function(b,c,d,e){return a.isBlank(c)||a.isBlank(d)||!a.isFunc(e)?b:b.replace(new RegExp("(?:\\"+c+")([\\s\\S]*?)(?:"+d+")","gim"),e)},a.querySelector=function(a,b,c){return null==b&&(b=!1),null==c&&(c=document),b?c.querySelectorAll(a):c.querySelector(a)},a.query=function(){var b,c,d,e,f,g;switch(e=1<=arguments.length?F.call(arguments,0):[],d=e.length,g="",c=!1,d){case 1:case 2:case 3:g=e[0],2===d&&(a.isBoolean(e[1])?c=e[1]:b=e[1]),3===d&&(b=e[1],c=e[2])}if(b=b||document,/^[A-Za-z0-9]+$/.test(g)){if(f=a.querySelector(g,c,b),null!==f)return f;g="[name="+g+"]"}return a.querySelector(g,c,b)},a.removeEl=function(){var b,c;c=1<=arguments.length?F.call(arguments,0):[],b=a.query(c),b&&b.parentNode.removeChild(b)},a.chkParam=function(){var b,c,d,e;if(e=1<=arguments.length?F.call(arguments,0):[],d=e[0],c=e[1]||"",b=a.slice(e,2),!d)throw new Error(a.format(c,b));return!0},a.fillParam=function(){var b,c,d,e,f,g,h,i,j,k;switch(g=1<=arguments.length?F.call(arguments,0):[],c="",b=null,j=["div","span"],f=g.length){case 1:b=g[0];break;case 3:case 2:3===f&&(j=j.concat(a.isArray(g[2])?g[2]:[g[2]])),c=g[0],b=g[1]}c=a.startIf(c,"#");for(e in b)k=b[e],i=null,i=a.startWith(e,["#","\\."])?c+" "+e:c+" [name="+e+"]",d=a.query(i),a.isBlank(d)||(h=(d.tagName||"").toLowerCase(),H.call(j,h)>=0?d.innerHTML=k:d.value=k)},a.getParam=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(h=arguments[0],i=2<=arguments.length?F.call(arguments,1):[],h=a.startIf(h,"#"),e=["hidden","text","checkbox","password","tel","email","url","number","date","time","datetime","month"],j=["li"],d=["select"].concat(i),m=0,k=e.length;k>m;m++)q=e[m],d.push("input[type="+q+"]");if(c={},b=a.query(h),a.isBlank(b))return c;for(o=a.query(d.join(","),b,!0),n=0,l=o.length;l>n;n++)f=o[n],g=f.getAttribute("name"),(g||"").length>0&&(c[g]=a.has(f,"value")?(p=(f.tagName||"").toLowerCase(),H.call(j,p)>=0?f.innerText:a.trim(f.value)):f.innerHTML);return c},w=function(a){var b,c,d,e;c=[];for(b in a)e=a[b],c.push(b);return d=new RegExp(c.join("|"),"ig"),function(b){return b.replace(d,function(b,c,d,e,f){var g;return g=a[b]||g})}},a.replacer=function(a){return new w(a)},u=function(b,c,d,e){var f,g;if(f=d||B,a.has(f,b)&&!e)throw new Error("module exists: "+b);f[b]=c,a.isFunc(c)&&f.mixin&&(g={},g[b]=c,f.mixin(g))},a.register=function(){var b,c,d,e;if(c=1<=arguments.length?F.call(arguments,0):[],a.isJson(c[0])){d=c[0];for(b in d)e=d[b],u(b,e,c[1],c[2])}else u.apply(this,arguments)},a.unregister=function(a,b){delete(b||B)[a]},a.methodRegister=function(a,b,c,d){l(a,b,c,d)},A=function(b,c){return(a.isUndefined(c)?a.getToStringShowType():c)?b:""},a.asStr=function(a,b,c){return g(a,b||"",c||!1)},a.rmEvtProp=function(b,c){var d,e,g,h;if(g={},a.isObject(b)&&a.isJson(b))for(e in b)h=b[e],a.isEvent(h)?(d=A("[object event]: ")+h.type,c&&(g[e]=d),a.isInfoEnabled()&&(f.getC().info("The "+d+" from '"+e+"' below is event detail:"),f.getC().info(h))):g[e]=h;return g},g=function(b,c,d){var e,f,h,j,k,l,m,n,o,p,q,r,s,t,u;switch(j=[],r=c||a.CRLF,q=a.type(b),m=a.type(b,!0)+": ",t=g,q){case i[11]:case i[7]:case i[10]:case i[2]:case i[5]:case i[6]:j.push(A(m,d)+b);break;case i[3]:case i[9]:j.push(A(m,d)+String(b));break;case i[4]:j.push(A(m,d)+(b.stack||b));break;case i[0]:case i[1]:for(q===i[0]&&(b=a.slice(b)),f=[],s=0,p=b.length;p>s;s++)u=b[s],f.push("object"==typeof u?t(u,r,!1):u);j.push(A(m,d)+"["+r+f.join(","+r)+r+"]");break;case i[8]:if(a.getToStringEvent()||(b=a.rmEvtProp(b,!0)),y.JSON&&a.isJson(b))try{e=[],j.push(JSON.stringify(b,function(a,b){if("object"==typeof b&&null!==b){if(-1!==e.indexOf(b))return;e.push(b)}return b}))}catch(v){l=v,a.warn(l.message,"JSON.stringify error (ignorable)")}break;default:h=[];for(o in b)G.call(b,o)&&(u=b[o],/^HTML/.test(q)?(n="innerHTML",k="documentElement",a.has(u,n)?u=u+" "+u[n]:a.has(u,k)&&(u=u+" "+u[k])):u=a.isJson(u)?t(u):u,h.push(o+": "+u));j.push(A(m,d)+"{"+r+h.join(","+r)+r+"}")}return j.join(r)},s=function(b,c){return l(B,b,function(a,d,e,f){return k({name:b,level:c},a,d,e,f)}),l(B,b+"Enabled",function(){return f.getC()&&parseInt(c)>=parseInt(a.getLogger())},"is"),l(B,b+"Enabled",function(){return a.setLogger(r[b])},"set")};for(p in r)E=r[p],E!==r.none&&s(p,E);k=function(b,c,d,e,h){var i,j;i=f.getC(),i&&parseInt(b.level)>=parseInt(a.getLogger())&&i[b.name]&&(j=a.getLogPrefix(b.name)+(d?d+a.CRLF:"")+g(c,e,h),i[b.name].call(i,j))},a.console=function(b,c){return a.isNull(b)?(f.setC(!1),b):((!f.getC()||c)&&(a.isFunc(b)?f.setC({log:b,info:b,warn:b,error:b}):a.isObject(b)?f.setC(b):a.isUndefined(y.console)||f.setC(y.console)),f.getC())},a.getLoggerName=function(b){return b=b||a.getLogger(),a.getKey(r,parseInt(b)>r.none?r.none:b)},h=function(){var b,c,d,e;return e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,c=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,b=function(b,c){return a.prefix(b,c||2)},function(f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u;if(a.isUndefined(g)&&a.isString(f)&&!/\d/.test(f)&&(g=f,f=void 0),q=a.getDateI18n(),o=a.getDateMask(),f=a.isBlank(f)?new Date:new Date(f),isNaN(f))throw SyntaxError("invalid date: "+f);return g=String(o[g]||g||o["default"]),"UTC:"===g.slice(0,4)&&(g=g.slice(4),h=!0),m=a.isBlank(h)?"get":"getUTC",n=f[m+"Date"](),i=f[m+"Day"](),r=f[m+"Month"](),u=f[m+"FullYear"](),j=f[m+"Hours"](),l=f[m+"Minutes"](),t=f[m+"Seconds"](),k=f[m+"Milliseconds"](),s=a.isBlank(h)?f.getTimezoneOffset():0,p={d:n,dd:b(n),ddd:q.day[i],dddd:q.day[i+7],m:r+1,mm:b(r+1),mmm:q.month[r],mmmm:q.month[r+12],yy:String(u).slice(2),yyyy:u,h:j%12||12,hh:b(j%12||12),H:j,HH:b(j),M:l,MM:b(l),s:t,ss:b(t),l:b(k,3),L:b(k>99?Math.round(k/10):k),t:12>j?"a":"p",tt:12>j?"am":"pm",T:12>j?"A":"P",TT:12>j?"AM":"PM",Z:h?"UTC":(String(f).match(c)||[""]).pop().replace(d,""),o:(s>0?"-":"+")+b(100*Math.floor(Math.abs(s)/60)+Math.abs(s)%60,4),S:["th","st","nd","rd"][n%10>3?0:(n%100-n%10!==10)*n%10]},g.replace(e,function(a){return a in p?p[a]:a.slice(1,a.length-1)})}},h=h(),a.addDateMask=function(b){return a.extend(t.dateMask,b||{})},a.dateFmt=function(a,b,c){return h(a,b,c)},a.keys=function(b,c){var d;if(null==c&&(c=function(){return!0}),a.isObject(b)&&Object.keys)return Object.keys(b);d=[];for(p in b)G.call(b,p)&&(E=b[p],c(E,p)&&d.push(p));return d},a.vals=function(b){var c,d,e,f,g,h;for(c=a.keys(b),d=c.length,h=new Array(d),g=[],f=0,e=c.length;e>f;f++)p=c[f],g.push(b[p]);return g},a.funcs=function(b){return a.keys(b,function(b){return a.isFunc(b)})},j=function(b,c){return a.prototype[b]=function(){var b;return b=[this._wrapped],Array.prototype.push.apply(b,arguments),x.call(this,c.apply(a,b))}},a.mixin=function(b){var c,d,e,f,g;for(g=a.funcs(b),f=0,d=g.length;d>f;f++)e=g[f],c=a[e]=b[e],j(e,c)},x=function(b){return this._chain?a(b).chain():b},a.mixin(a),a.chain=function(b){return a(b).chain()},a.prototype.chain=function(){return this._chain=!0,this},a.prototype.value=function(){return this._wrapped},function(a,b){var c;c=function(b,c,d){return a.dateFmt(c,b,d)},a.each(a.getDateMask(),function(b,d){a.methodRegister(c,d,function(c,d){return a.dateFmt(c,b,d)})}),c.idesc={year:" years ago",month:" months ago",week:" weeks ago",day:" days ago",hour:" hours ago",minute:" minutes ago",just:"just now"},c.time=function(b){var c;return b=b||new Date,a.isDate(b)||(c=new Date(b),b=isNaN(c)?new Date(b.replace(/-/g,"/")):c),b.getTime()},c.interval=function(a){var b,d,e,f,g;return g=1e3,b=86400,d=3600,f=60,a=c.time(a),e=(c.time()-a)/g,e>=0?e/15768e4>1?c["default"](a):e/31536e3>1?parseInt(e/31536e3)+c.idesc.year:e/2592e3>1?parseInt(e/2592e3)+c.idesc.month:e/604800>=1?7+c.idesc.day:1>e/604800&&e/b>=1?parseInt(e/b)+c.idesc.day:1>e/b&&e/d>=1?parseInt(e/d)+c.idesc.hour:d>e&&e>=f?parseInt(e/f)+c.idesc.minute:c.idesc.just:c["default"](a)},a.register(b,c)}(B,"when"),function(a,b){var c,d;d=function(a,b){return e(a,b)},c={};var e=function f(a,b){var d=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):c[a]=c[a]||f(document.getElementById(a).innerHTML);return b?d(b):d};a.register(b,d)}(B,"tmpl"),function(a,b){"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=a:(y.kiwi=y[b]=a,"function"==typeof define&&define.amd&&define(b,[],function(){return a}),"function"==typeof define&&define.cmd&&define(function(c,d,e){d[b]=a}))}(B,"lemon")}).call(this);
	!function(a,b){var c,d,e,f,g,h,i;f=function(a){return d(a)},f.reverse=function(a){return i(a)},f.highlight=function(a){return j(a)},f.get=function(a,b){return value(a,b)},e=function(a,b){return p[b-1]},g=function(a){return new Array(a+1).join("	")},value=function(b,c){c=c||"";var d=c.indexOf(".")>0?c.split("."):[c],e=b;return a.each(d,function(b,c){var d=b;if(b.indexOf("[")>0&&b.indexOf("]")>0){var f=a.betn(b,"[","]",!0);b=b.replace(f.join(""),"")}if(e=e&&e[b],a.isArray(e)){var g=a.betn(d,"[","]");if(g.length>0){var h=e;a.each(g,function(a,b){h=h&&h[parseInt(a)]}),e=h}}}),e},h=function(b,c,d){var e,f,g,h;return g="",e=a.trim(b),f=e.split(c),f.length>0?(h=[],a.each(f,function(b,c){h.push(a.trim(b))}),g=h.join(d?"":c)):g=e,g},c=function(b){if(a.isBlank(b))return"{}";if(a.isString(b))return b;if(JSON&&a.isJson(b))return JSON.stringify(b);throw new Error("This browser JSON.stringify is unsupported.")},i=function(a){var b;return b=h(c(a),"\n"),b=h(b,"["),b=h(b,"]"),b=h(b,"{"),b=h(b,"}"),b=h(b,","),b=h(b,":")},f.style={".string":{color:"green"},".number":{color:"blue"},".boolean":{color:"darkorange"},".null":{color:"magenta"},".key":{color:"gray"}},f.toCSS=function(a){var b="";for(var c in a){b+=c+" {\n";for(var d in a[c])if("CSS-INHERIT-SELECTOR"==d)for(var e in a[a[c][d]])b+="	"+e+":"+a[a[c][d]][e]+";\n";else b+="	"+d+":"+a[c][d]+";\n";b+="}\n"}return b},f.addStyle=function(b,c){var d;c=c||"json_syntax",a.removeEl("#"+c),d=document,b=d.createElement("style"),b.type="text/css",b.id=c,b.innerHTML=a.isString(b)?b:f.toCSS(f.style),a.query("head").appendChild(b)};var j=function(a){return f.addStyle(),a=d(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var b="number";return/^"/.test(a)?b=/:$/.test(a)?"key":"string":/true|false/.test(a)?b="boolean":/null/.test(a)&&(b="null"),'<span class="'+b+'">'+a+"</span>"})};d=function(a){var b,d,f,h,j,k;if(JSON)return JSON.stringify(JSON.parse(c(a)),void 0,4);for(h="",f=0,a=i(c(a)),d=j=0,k=a.length;k>=0?k>j:j>k;d=k>=0?++j:--j)switch(b=a.charAt(d)){case"{":case"[":h+=b+"\n"+g(++f);break;case"}":case"]":h+="\n"+g(--f)+b;break;case",":h+=",\n"+g(f);break;case":":h+=": ";break;default:h+=b}return h=h.replace(/\[[\d,\s]+?\]/g,function(a){return a.replace(/\s/g,"")}).replace(/\\(\d+)\\/g,e).replace(/\\(\d+)\\/g,e)},a.register(b,f)}(this.kiwi,"json");
	!function(a,b,c){function d(a){return function(){var b=_a.slice.call(arguments,0);b.unshift(g),k.appendChild(g),g.addBehavior("#default#userData"),g.load(i);var c=a.apply(store,b);return k.removeChild(g),c}}function e(a){return a.replace(/^d/,"___$&").replace(n,"___")}var f={};f=function(a,c,d){if(b.isUndefined(c))return f.get(a);if(b.isNull(c)){var e=f.get(a);return f.remove(a),e}return f.set(a,c),c};var g,h=a.document,i="localStorage",j="script";if(f.isSupport=function(){try{return i in a&&a[i]}catch(b){return!1}},f.serialize=function(c){return a.JSON&&b.isJson(c)?JSON.stringify(c):c},f.deserialize=function(a){if("string"!=typeof a)return a||void 0;try{return JSON.parse(a)}catch(b){return a||void 0}},f.transact=function(a,b,c){var d=f.get(a);null==c&&(c=b,b=null),typeof d==_undef&&(d=b||{}),c(d),f.set(a,d)},f.exists=function(a){return null!=f.get(a)},f.keys=function(){var a=[];return $.each(f.getAll(),function(b,c){a.push(b)}),a},f.size=function(a,b){return f.keys().length},f.isSupport())g=a[i],f.set=function(a,b){return void 0===b?f.remove(a):(g.setItem(a,f.serialize(b)),b)},f.get=function(a){return f.deserialize(g.getItem(a))},f.remove=function(a){g.removeItem(a)},f.clear=function(){g.clear()},f.getAll=function(){var a={};return f.forEach(function(b,c){a[b]=c}),a},f.forEach=function(a){for(var b=0;b<g.length;b++){var c=g.key(b);a(c,f.get(c))}};else if(h.documentElement.addBehavior){var k,l;try{l=new ActiveXObject("htmlfile"),l.open(),l.write("<"+j+">document.w=window</"+j+'><iframe src="/favicon.ico"></iframe>'),l.close(),k=l.w.frames[0].document,g=k.createElement("div")}catch(m){g=h.createElement("div"),k=h.body}var n=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");f.set=d(function(a,b,c){return b=e(b),void 0===c?f.remove(b):(a.setAttribute(b,f.serialize(c)),a.save(i),c)}),f.get=d(function(a,b){return b=e(b),f.deserialize(a.getAttribute(b))}),f.remove=d(function(a,b){b=e(b),a.removeAttribute(b),a.save(i)}),f.clear=d(function(a){var b=a.XMLDocument.documentElement.attributes;a.load(i);for(var c,d=0;c=b[d];d++)a.removeAttribute(c.name);a.save(i)}),f.getAll=function(a){var b={};return f.forEach(function(a,c){b[a]=c}),b},f.forEach=d(function(a,b){for(var c,d=a.XMLDocument.documentElement.attributes,e=0;c=d[e];++e)b(c.name,f.deserialize(a.getAttribute(c.name)))})}b.register(c,f)}(this,this.kiwi,"store"),function(a,b,c){var d={};d.pushState=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/),d.store=b.store.isSupport()?!0:!1,b.register(c,d)}(this,this.kiwi,"support");
</script>
<style type="text/css">
    .fixed-panel { min-height: 430px; max-height: 430px; overflow-y: scroll; }
    .fixed-dropdown { min-height: 530px; max-height: 530px; overflow-y: scroll; max-width: 350px; }
    .block-grey { background-color: #e6e6e6; }

	.cm-s-lemon .CodeMirror { background-color:#ffffff; color:#2e383c; line-height:1.4375; }
	.cm-s-lemon .cm-comment {color:#75787b}
	.cm-s-lemon .cm-keyword, .cm-s-lemon .cm-property {color:gray}
	.cm-s-lemon .cm-atom {color: magenta} .cm-s-lemon .cm-number {color:blue}
	.cm-s-lemon .cm-node,.cm-s-lemon .cm-tag {color:#9c3328}
	.cm-s-lemon .cm-string {color:green}
	.cm-s-lemon .cm-variable,.cm-s-lemon .cm-qualifier {color:#047d65}
	.cm-s-lemon pre { padding:0; }
	.cm-s-lemon .CodeMirror-gutters { border:none; border-right:10px solid transparent; background-color:transparent; }
	.cm-s-lemon .CodeMirror-linenumber { padding:0; color:#e0e2e5; }
	.cm-s-lemon .CodeMirror-guttermarker { color: #1d75b3; }
	.cm-s-lemon .CodeMirror-guttermarker-subtle { color: #e0e2e5; }
</style>
</head>
<body>
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="javascript:void(0);">51RP Manual
					API</a>
			</div>

			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li class="dropdown"><a href="#" class="dropdown-toggle"
						data-toggle="dropdown" role="button" aria-expanded="false">Environment
							<span class="caret"></span>
					</a>
						<ul class="dropdown-menu fixed-dropdown" role="menu" id="which_env">
							<li><a href="#">Test</a></li>
							<li><a href="#">Product</a></li>
						</ul></li>
				</ul>
				<ul class="nav navbar-nav">
					<li class="dropdown"><a href="#" class="dropdown-toggle"
						data-toggle="dropdown" role="button" aria-expanded="false">Which
							API <span class="caret"></span>
					</a>
						<ul class="dropdown-menu fixed-dropdown" role="menu" id="which_api">
							<li><a href="#">api1</a></li>
							<li><a href="#">api2</a></li>
						</ul></li>
				</ul>
				<form class="navbar-form navbar-left" role="search">
					<div class="form-group">
						<div class="input-group">
					      <div class="input-group-btn">
					        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <span class="caret"></span></button>
					        <ul class="dropdown-menu">
					          <li role="separator" class="divider"></li>
					          <li><a href="javascript:void(0);" onclick="api.typeSearch(1)">Defined APIs</a></li>
					          <li><a href="javascript:void(0);" onclick="api.typeSearch(4)">Tag</a></li>
					          <li><a href="javascript:void(0);" onclick="api.typeSearch(5)">Favourite</a></li>
					          <li><a href="javascript:void(0);" onclick="api.typeSearch(6)">The Histories</a></li>
					          <li role="separator" class="divider"></li>
					        </ul>
					      </div>
					      <input type="text" class="form-control" id="input_search" placeholder="API & Histories..">
					    </div>
					</div>
					<button type="submit" class="btn btn-default" id="btn_search">
						<span class="glyphicon glyphicon-search" title="Search"></span>
					</button>
					<button type="submit" class="btn btn-default" id="btn_request">Request</button>					
					<div class="btn-group">
					  <button type="submit" class="btn btn-default" id="btn_request_tab">Request In New Tab</button>
					  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					    <span class="caret"></span>
					    <span class="sr-only">Toggle Dropdown</span>
					  </button>
					  <ul class="dropdown-menu">
					    <li role="separator" class="divider"></li>
					    <li><a href="javascript:void(0);" id="btn_request_get">Request with Get</a></li>
					    <li role="separator" class="divider"></li>
					    <li><a href="javascript:void(0);" id="btn_request_post">Request with Post</a></li>
					    <li role="separator" class="divider"></li>
					  </ul>
					</div>
					
					<button type="submit" class="btn btn-default" id="btn_history">History</button>
				</form>
				<ul class="nav navbar-nav navbar-right">
				</ul>
			</div>
		</div>
	</nav>
	<div id="message"></div>

	<div class="row" style="margin: 0 5px;">
		<div class="col-md-6">
			<div class="panel panel-default" style="margin-bottom:2px;">
				<div class="panel-heading" title="Right Click Toggle Edit and View Mode">
					<!-- <h3 class="panel-title">Request </h3> -->
					Request
					<div class="btn-group btn-group-xs pull-right">
						<button type="button" class="btn btn-success" id="from_url">
						<span class="glyphicon glyphicon-subscript" title="Set Request Data From URL"></span></button>
						<button type="button" class="btn btn-success" id="as_default">
						<span class="glyphicon glyphicon-camera" title="Set Request Default Value"></span></button>
						<button type="button" class="btn btn-success" id="copy_url">
						<span class="glyphicon glyphicon-copy" title="Show Request URL"></span></button>
						<button type="button" class="btn btn-success" data-element="#request" data-toggle="modal" data-target="#modal_tpl">
						<span class="glyphicon glyphicon-tree-deciduous" title="Show Request In Fullscreen (Esc Quit)"></span></button>
						<button type="button" class="btn btn-success" data-element="both" data-toggle="modal" data-target="#modal_tpl">
						<span class="glyphicon glyphicon-eye-open" title="Show Request and Response In Fullscreen (Esc Quit)"></span></button>
						<button type="button" class="btn btn-success" id="api_define">
						<span class="glyphicon glyphicon-question-sign" title="Show the Define API"></span></button>
					</div>
				</div>
				<div class="panel-body" id="view_left">
					<form>
						<div class="form-group">
							<textarea class="form-control" rows="21" id="request"></textarea>
						</div>
					</form>

				</div>
				<!-- <div class="panel-footer"> </div> -->
			</div>
		</div>
		<div class="col-md-6">
			<div class="panel panel-default"  style="margin-bottom:2px;">
				<div class="panel-heading" title="Right Click Toggle Edit and View Mode">
					Response
					<div class="btn-group btn-group-xs pull-right">
						<button type="button" class="btn btn-success" data-element="#response" data-toggle="modal" data-target="#modal_tpl">
						<span class="glyphicon glyphicon-leaf" title="Show Response In Fullscreen (Esc Quit)"></span></button>
						<button type="button" class="btn btn-success" data-element="both" data-toggle="modal" data-target="#modal_tpl">
						<span class="glyphicon glyphicon-eye-open" title="Show Request and Response In Fullscreen (Esc Quit)"></span></button>
					</div>
				</div>
				<div class="panel-body" id="view_right">
					<form>
						<div class="form-group">
							<textarea class="form-control" rows="21" id="response"></textarea>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	
<div class="modal fade"  tabindex="-1" id="modal_tpl" role="dialog"></div>
	
<script src="http://cdn.bootcss.com/labjs/2.0.3/LAB.min.js"></script>
<script type="text/javascript"> 
	lemon.setBasePath('http://cdn.bootcss.com');
	lemon.register({
		css: function(target) {
			lemon.each(lemon.isArray(target) ? target : [target], 
			function(style, idx) {
	    		var link = document.createElement('link');
	    		link.setAttribute('rel', 'stylesheet');
	    		link.setAttribute('type', 'text/css');
	    		link.setAttribute('href', lemon.getUrl(style));
	    		lemon.query('head').appendChild(link);
	    	});
		}
	});
	
	lemon.css('bootstrap/3.3.5/css/bootstrap.min.css');
	$LAB
	.script(lemon.getUrl('/jquery/2.1.4/jquery.min.js')).wait()
	.script(lemon.getUrl('/bootstrap/3.3.5/js/bootstrap.min.js'))
	.wait(function() { api.initialize(); });

	var cmprfix = 'codemirror/5.6.0/';
	var queue = $LAB
		.queueScript(lemon.getUrl(cmprfix + 'codemirror.min.js'))
		.queueWait()
		.queueScript(lemon.getUrl(cmprfix + 'addon/dialog/dialog.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/search/searchcursor.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/search/matchesonscrollbar.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/search/search.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/scroll/annotatescrollbar.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/edit/matchbrackets.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/lint/javascript-lint.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/hint/javascript-hint.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'mode/javascript/javascript.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/lint/json-lint.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/selection/active-line.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/edit/closebrackets.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/display/fullscreen.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/hint/show-hint.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/comment/comment.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/comment/continuecomment.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/fold/foldcode.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/fold/foldgutter.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/fold/brace-fold.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/fold/indent-fold.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/fold/comment-fold.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/hint/anyword-hint.min.js'))
		.queueScript(lemon.getUrl(cmprfix + 'addon/search/match-highlighter.min.js'))
		//.queueWait(function() {});
		.queueWait(function() { after.initialize(); });
	
	lemon.delay(function() {
		if (!api.intialized) {
			api.initialize();
		}
		
		lemon.css([
		    cmprfix + 'codemirror.min.css',
		    cmprfix + 'addon/dialog/dialog.min.css',
		    cmprfix + 'addon/search/matchesonscrollbar.min.css',
		    cmprfix + 'addon/display/fullscreen.min.css',
		    cmprfix + 'addon/hint/show-hint.min.css',
		    cmprfix + 'addon/fold/foldgutter.min.css'
		]);
		queue.runQueue();
	}, 500);
</script>

<script type="text/html" id="table_tmpl">
<div class="panel panel-default" style="border:0px;">
  <!-- Default panel contents -->
  <!-- <div class="panel-heading">Panel heading</div> -->
  <%
	var clientW = document.body.clientWidth - 110;
	if (lemon.isBlank(histories)) {
		clientW = clientW + 35;
	}
    var panelH = document.body.clientHeight - 85;
  %>
  <div class="panel-body fixed-panel" style="height:<%=panelH%>px;max-height:<%=panelH%>px;">

	<% if (!lemon.isBlank(apis)) { %>
	<!-- Table -->
	<table class="table table-hover">
		<caption>API</caption>
        <thead> <tr> <th>#</th> <th>
			<button type="button" class="btn btn-default btn-sm" id="btn_tgl_api">Request</button>
			<button type="button" class="btn btn-default btn-sm" id="btn_tgl_interf">Collapse Toggle</button>
			</th> <th></th></tr> </thead>
        <tbody>
		<% 
		   var interfType = '';
		   lemon.each(apis, function(v, k) {
				if (v && !lemon.isBlank(v.request)) {
					if (interfType != v.type.id) {
						interfType = v.type.id;
		%>
			<tr onclick="api.interfType(<%= interfType %>)"> <th></th> <td> <h4><span class="label label-info"><span class="glyphicon glyphicon-flag"></span> <%= v.type.name %></span></h4> </td> </tr>
		<%
					}
		%>
		   <tr id="<%= k %>" type="<%= interfType %>">
            <th scope="row">
			</th>
			<td onDblClick="api.onSelect('<%= k %>')">
			<!-- <span class="badge"><%= v.name %></span> -->
			<blockquote style="width:<%=clientW - 60%>px;">
  				<p>
					<pre style="background-color:#ffffff;" tgl-api="tgl"><%= lemon.json.highlight(v.request) %></pre>
				</p>
				<%= api.showNote(v.note) %>
				<footer>
					<%= v.name %> <cite><%= v.desc %></cite>
				</footer>
			</blockquote>
			</td>
			<td>
				<button type="button" class="btn btn-default btn-xs" onclick="api.setAPIDefaultVal('<%= v.name %>')" id="set_default_<%= v.name %>">
					<span class="glyphicon glyphicon-camera" title="Set API Default Value"></span>
				</button>
				<button type="button" class="btn btn-default btn-xs" onclick="api.hisTglRequResp('<%= k %>', 3)" id="his_api_requ_<%= v.k %>">
					<span class="glyphicon glyphicon-tree-deciduous" title="Toggle Request"></span>
				</button>
			</td>
          </tr>
		<% }}); %>
        </tbody>
     </table>
	<% } %>

  	<% if (!lemon.isBlank(histories)) { %>
	<!-- Table -->
	<table class="table table-hover">
		<caption>History Request</caption>
        <thead> <tr> <th>#</th> <th>
			<div class="row">
  				<div class="col-md-6">

				<h4><span class="label label-default"><span class="glyphicon glyphicon-filter"></span> Request Response</span></h4>
				<button type="button" class="btn btn-default btn-sm" id="btn_tgl_requ">Request</button> 
				<button type="button" class="btn btn-default btn-sm" id="btn_tgl_resp">Response</button>
				<button type="button" class="btn btn-default btn-sm" id="btn_tgl_interval">Collapse Toggle</button>

				<h4><span class="label label-default"><span class="glyphicon glyphicon-filter"></span> Filter Favourite</span></h4>
				<button type="button" class="btn btn-default btn-sm" id="prop_filter_1"><span class="glyphicon glyphicon-star"></span>Favourite</button>

				<h4>
					<span class="label label-default"><span class="glyphicon glyphicon-filter"></span> Filter Tags</span>
					<div class="input-group input-group-sm"> 
						<span class="input-group-addon"><span title="Toggle Tag Manage Bar" class="glyphicon glyphicon-tag"></span></span>
						<input type="text" class="form-control" placeholder="Tag" id="tag_input">
      					<span class="input-group-btn input-group-sm"> 
							<button class="btn btn-default btn-sm" type="button" id="tag_add"><span class="glyphicon glyphicon-plus"></span></button> 
							<button class="btn btn-default btn-sm" type="button" id="tag_edit"><span class="glyphicon glyphicon-edit"></span></button> 
							<button class="btn btn-default btn-sm" type="button" id="tag_rem"><span class="glyphicon glyphicon-minus"></span></button> 
						</span>
    				</div>
				</h4>
				<div id="tag_group">
				<%
					lemon.each(api.tag(), function(v, k) {
						var tagName = decodeURI(v.name);
						var aTag = [
								' <button type="button" onclick="api.ontag('+ v.id + ');"',
								' class="btn btn-default btn-sm" style="margin-top:5px;" ',
								' id="tag_filter_'+ v.id + '"> ' + tagName + ' </button> '
                            	].join('');
				%>
				<%= aTag %>
				<%
					});
				%>
				</div>

				</div>
  				<div class="col-md-6">

					<h4><span class="label label-default"><span class="glyphicon glyphicon-filter"></span> Filter Environment</span></h4>
					<%
						lemon.each(api.preference.service(), function(v, k) {
					%>
						<button type="button" class="btn btn-default btn-sm" id="env_filter_<%= v.env %>"><%= v.desc %></button>
					<%
						});
					%>

					<h4><span class="label label-default"><span class="glyphicon glyphicon-filter"></span> Filter Server</span></h4>
					<%
						lemon.each(api.preference.service(), function(env, k) {
					%>
						<h6><span class="label label-info"><span class="glyphicon glyphicon-hand-down"></span> <%= env.env %></span></h6>
					<%
						lemon.each(env.serv, function(serv, k) {
							var servName = api.getInterfGroup(serv.type.id).name + (lemon.isBlank(serv.note) ? '' : (' - ' + serv.note));
					%>
							<button type="button" class="btn btn-default btn-sm" style="margin-top:5px;" id="filter_<%= serv.id %>"><%= servName %></button>
					<%
							});
						});
					%>

				</div>
			</div>

			</th><th></th></tr> </thead>
        <tbody id="his_body">
		<%= theHisTrs %>
        </tbody>
     </table>
	<% } %>
  </div>
</div>
</script>

<script type="text/html" id="his_tr_tmpl">
<% 
	if (!lemon.isBlank(histories)) {
		var no = intlNo - 1;
		var clientW = document.body.clientWidth - 110;
		if (lemon.isBlank(histories)) {
			clientW = clientW + 35;
		}
	    var panelH = document.body.clientHeight - 150;
	
	   var tmp = '';
	   var batch = 0;
	   lemon.each(api.historySortDesc(histories), function(v, k) {
		   var env = api.env.which(v.interf);
		   if (lemon.isBlank(env)) { return; }
		   no++, tmp = lemon.when.interval(v.when);
	       if (tmp != api.previousInterval.when) {
				batch = lemon.uniqueId();

				api.previousInterval = {
					when: tmp,
					batch: batch
				};			

				api.batches.push(batch);
		%>
				<tr onclick="api.interval(<%= batch %>)"> <th></th> <td> <h4><span class="label label-info"><span class="glyphicon glyphicon-time"></span> <%= api.previousInterval.when %></span></h4> </td> </tr>
		<%
		   } else {
				batch = api.previousInterval.batch;
		   }
		   
		%>
				<%
					var hisTags = api.customHis(v.k, 'tag') || [];
					var hisTagMark = [];
					var hisShowTags = [];
					lemon.each(hisTags, function(tagId, idx) {
						var aTag = api.tag(tagId);
						if (lemon.isBlank(aTag)) {
							api.customHis(v.k, 'tag', -1, tagId);
						} else {
							hisTagMark.push('tag' + tagId + '="' + tagId + '"');
							hisShowTags.push(api.elhistag(v.k, tagId, aTag.name));
						}
					});
				%>
	   <tr id="<%= v.k %>" batch="<%= batch %>" <%= hisTagMark.join(' ') %> interf="<%= env.id %>" env="<%= env.env %>" his="1" prop="<%= api.customHis(v.k,'fav') %>">
	          <th scope="row">
		</th>
	          <td onDblClick="api.onSelect('<%= v.k %>')">
			<blockquote style="width:<%=clientW - 25%>px;">
				<div id="tag_area_<%= v.k %>"><%= hisShowTags.join(' ') %></div>
						<p>
					<pre style="background-color:#ffffff;height:100%;" tgl-requ="tgl"><%= lemon.json.highlight(v.request) %></pre>
					<pre style="background-color:#ffffff;height:100%;" tgl-resp="tgl"><%= lemon.json.highlight(v.response) %></pre>
				</p>
				<%
					var envDesc = env.desc + '  ' + env.type.name + (lemon.isBlank(env.note) ? '' : (' - ' + env.note));
					var theStyle = 'PRODUCT' === env.env ? 'danger' : 'success';
				%>
				<div id="show_note_<%= v.k %>">
				<% 
					var note = api.customHis(v.k, 'note') || '';
					if (!lemon.isBlank(note)) {
				%>
					<div class="alert alert-warning" role="alert" id=""><%= note %></div>
				<% } %>
				</div>
				<footer><span class="badge"><%= no %></span> <font class="text-<%= theStyle %>"><%= envDesc %></font></footer>
				<footer>
					<%= (v.name || '') + '  ' + v.api %> 
					<cite><code><font class="text-<%= theStyle %>"><%= v.interf %></font></code><%= ' ' + v.when %></cite>
				</footer>
			</blockquote>
		</td>
		<td>
			<button type="button" class="btn btn-default btn-xs" onclick="api.historyAPIDesc(<%= v.k %>, '<%= v.api %>')" id="desc_<%= v.k %>">
				<span class="glyphicon glyphicon-question-sign" title="Show the Define API Description"></span>
			</button>
			<button type="button" class="btn btn-default btn-xs" onclick="api.onSelectSinleClick(this)" clkey="<%= v.k %>">
				<span class="glyphicon glyphicon-eye-open" title="Toggle Request Response"></span>
			</button>
			<button type="button" class="btn btn-default btn-xs" onclick="api.hisTglRequResp(<%= v.k %>, 1)" id="his_tgl_requ_<%= v.k %>">
				<span class="glyphicon glyphicon-tree-deciduous" title="Toggle Request"></span>
			</button>
			<button type="button" class="btn btn-default btn-xs" onclick="api.hisTglRequResp(<%= v.k %>, 2)" id="his_tgl_resp_<%= v.k %>">
				<span class="glyphicon glyphicon-leaf" title="Toggle Response"></span>
			</button>
			<button type="button" class="btn btn-default btn-xs" onclick="api.favourite(this, <%= v.k %>)">
				<% if (1 == api.customHis(v.k,'fav')) { %>
					<span class="glyphicon glyphicon-star" title="Toggle Favourite"></span>
				<% } else { %>
					<span class="glyphicon glyphicon-star-empty" title="Toggle Favourite"></span>
				<% } %>
			</button>
			<button type="button" class="btn btn-default btn-xs" onclick="api.pencil(<%= v.k %>, <%= no %>)" id="pencil_<%= v.k %>">
				<span class="glyphicon glyphicon-pencil" title="Note"></span>
			</button>
			<button type="button" class="btn btn-default btn-xs" onclick="api.itemTag(<%= v.k %>, <%= no %>)" id="tags_<%= v.k %>">
				<span class="glyphicon glyphicon-tags" title="Tags"></span>
			</button>
		</td>
	        </tr>
	<% }); }%>
</script>

<script type="text/html" id="setting_tmpl">
<%
	var clientW = document.body.clientWidth - 30;
    var panelH = document.body.clientHeight - 70;
%>
<div id="settings" style="height:<%=panelH%>px;max-height:<%=panelH%>px;width:<%=clientW%>px;">
    <ul id="" class="nav nav-tabs" role="tablist">
      <li role="presentation" class="">
      	<a href="#basic" id="basic-tab" role="tab" data-toggle="tab" aria-controls="basic" aria-expanded="true">Basic Setting</a>
      </li>
      <li role="presentation" class="">
      	<a href="#server" role="tab" id="server-tab" data-toggle="tab" aria-controls="server" aria-expanded="false">Define Server</a>
      </li>
      <li role="presentation" class="active">
      	<a href="#theapic" role="tab" id="theapic-tab" data-toggle="tab" aria-controls="theapic" aria-expanded="false">Define API</a>
      </li>
      <li role="presentation" class="dropdown">
        <a href="#" id="import_export_tab" class="dropdown-toggle" data-toggle="dropdown" aria-controls="import_export_tab-contents">
        	Import & Export <span class="caret"></span>
        </a>
        <ul class="dropdown-menu" aria-labelledby="import_export_tab" id="import_export_tab-contents">
          <li><a href="#import_tab" role="tab" id="import_tab-tab" data-toggle="tab" aria-controls="import_tab">@Import</a></li>
          <li><a href="#export_tab" role="tab" id="export_tab-tab" data-toggle="tab" aria-controls="export_tab">@Export</a></li>
        </ul>
      </li>
    </ul>
    <div id="myTabContent" class="tab-content"> <!-- style="overflow-y:auto;height:550px;" -->
      <div id="message_settings"></div>
      <div role="tabpanel" class="tab-pane fade in" id="basic" aria-labelledby="basic-tab">
        <div class="row" style="margin: 0 5px;">

		  <div class="col-md-4">
		  	<h4>Interface Group</h4>
		  	<div class="panel panel-default">
			  <div class="panel-body">
			    <textarea id="p_interf" style="border:0px solid #ffffff;width:368px;height:450px;"></textarea>
			  </div>
			</div>
		  </div>
		  
		  <div class="col-md-4">
		  	<h4>Environment</h4>
		  	<div class="panel panel-default">
			  <div class="panel-body">
			    <textarea id="p_env" style="border:0px solid #ffffff;width:368px;height:450px;"></textarea>
			  </div>
			</div>
		  </div>

		  <div class="col-md-4">
		  	<h4>Configuration</h4>
		  	<div class="panel panel-default">
			  <div class="panel-body">
			    <textarea id="p_config" style="border:0px solid #ffffff;width:368px;height:450px;"></textarea>
			  </div>
			</div>
		  </div>

		</div>
      </div>
      <div role="tabpanel" class="tab-pane fade" id="server" aria-labelledby="server-tab">

      </div>
      <div role="tabpanel" class="tab-pane fade active" id="theapic" aria-labelledby="theapic-tab">
        
      </div>
      <div role="tabpanel" class="tab-pane fade" id="import_tab" aria-labelledby="import_tab-tab">
        
      </div>
      <div role="tabpanel" class="tab-pane fade" id="export_tab" aria-labelledby="export_tab-tab">
        
      </div>
    </div>
 </div>
</script>

<script type="text/html" id="setting_server_tmpl">

<div class="row" style="margin: 0 5px;">

<div class="col-md-6">

	<select class="form-control input-lg">
    	<option value="">.input-lg</option>
    </select>

<label class="radio-inline">
  <input type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1"> 1
</label>
<label class="radio-inline">
  <input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2"> 2
</label>
<label class="radio-inline">
  <input type="radio" name="inlineRadioOptions" id="inlineRadio3" value="option3"> 3
</label>

	<textarea id="p_server" style="border:0px solid #ffffff;width:580px;height:221px;"></textarea>
</div>

<div class="col-md-6" style="overflow-y:auto;height:550px;">
<%
lemon.each(api.preference.service(), function(envGroup, k) { 
	var isProduct = 'PRODUCT' === envGroup.env;
	var clazz = isProduct ? 'danger' : 'info';
	lemon.each(api.env.servSortEsc(envGroup.serv), function(serv, k) {
		var servGroup = api.getInterfGroup(serv.type.id);
		var servName = lemon.repeat('&nbsp;', 1) + servGroup.name;
		var showServ = lemon.clone(serv); delete showServ.type;
		if (showServ.asDefault) {
			delete showServ.asDefault;
		}
%>
			<div class="thumbnail" tenv="<%=envGroup.env%>" tgroup="<%= serv.type.id %>" tid="<%= serv.id %>">
      			<div class="caption">
        			<p>
						<span class="badge"><%= serv.id %></span>
						<code><font class="text-<%= clazz %>""> <%= envGroup.desc %><%= servName %> </font></code>
						<% if (serv.asDefault && 1 === serv.asDefault) { %>
							<span class="label label-info pull-right">Default Server</span>
						<% } %>
					<p>
					<pre style="border:0px solid #ffffff;background-color:#ffffff;"><%= lemon.json.highlight(showServ) %></pre>
      			</div>
    		</div>
	<% }); %>
<% }); %>

</div>
</div>
</script>

<script type="text/javascript">
	root = window;
	location.hash = 'api';
	lemon.console();
	lemon.getset({
		env: null,
		api: null
	});
	
	var api = api || {
		batches: [],
		intialized: false,
		previousInterval: {
			when: '',
			batch: 0
		},
		initialize: function() {
			this.intialized = true;
			this.env.render();
			this.cmd.render();
			this.nav.render();
			this.mod.render();
		},
		nav: {
			render: function() {
				$('.dropdown-toggle').dropdown();
				$('[data-toggle="popover"]').popover({
					trigger:'hover',
					html:true
				}).on('show.bs.popover', function() { 
					$(this).data("bs.popover").tip().css({maxWidth: "600px"}); 
				});
				
				var $req = $('#btn_request');
				$req.click(function() {
					if (!api.chkRequest()) { return; }
					$req.button('loading');
					api.resp('');
					api.request(function(data) {
						api.resp(lemon.json(data));
						$req.button('reset');
					}, function() {
						$req.button('reset');
					});
				});

				api.requestGetPost('#btn_request_post');
				api.requestGetPost('#btn_request_get', 'get');

				$('#btn_request_tab').click(function() {
					if (!api.chkRequest()) { return; }
					var cleanData = api.getCleanRequestData();
					var param = api.getRequestData(cleanData);
					lemon.store.set(api.uniqueId(), {
						when: lemon.when(),
						request: cleanData, 
						response: null,
						interf: lemon.getEnv()
					});
					
					window.open(api.nav.getRequestURLwithParams(lemon.json.reverse(param), true));
				});

				$('#as_default').click(function() {
					var data = api.getCleanRequestData();
					var cmd = data.cmd;
					if (cmd) {
						api.defaultValue(cmd, data);
						api.inlineTip('#as_default');
					}
				});

				$('#from_url').click(function() {
					var data = api.requ();
					data = decodeURI(data);
					data = decodeURIComponent(data);
					var lidx = data.indexOf('{');
					var ridx = data.lastIndexOf('}');
					api.requ(data);
					if (lidx >= 0 && ridx >= 0) {
						try {
							api.requ(lemon.json(data.substring(lidx, ridx + 1)));
							var theServ = data.substr(0, data.indexOf('?'));
							lemon.setEnv(theServ);
							api.env.change(theServ);
						} catch(e) {
							var eMsg = 'Invalid request JSON';
							lemon.warn(e, eMsg);
							api.tip(eMsg + ': ' + lemon.asStr(e.message));
						}
					}
				});

				api.description('#api_define');
				api.popover('#copy_url', function() {
					var requestURL = api.nav.humanreadRequest();

					var h = 80;
			  		var w = document.body.clientWidth / 2;
			  		
			  		var html = [
							'<textarea id="request_url" style="border:0px solid #ffffff;height:' + h + 'px;width:' + w + 'px">' + requestURL + '</textarea>',
						].join('');
					
					return html;
				}, { 
					title: [
						'Request URL', 
						'<div class="pull-right">',
						'<span class="glyphicon glyphicon-pencil" title="encodeURIComponent" onclick="api.nav.copyEncodeUrl();"></span>',
					 	'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;',
				 		'<button type="button" class="close" aria-label="Close" onclick="javascript:$(\'#copy_url\').click();">',
				 		'<span aria-hidden="true">&times;</span></button>',
				 		'</div>'
				 	].join(''),
					placement: 'top'
				}).on('show.bs.popover', function() { 
					$(this).data("bs.popover").tip().css({
						maxWidth: (document.body.clientWidth / 2) + 200
					});
				}).on('shown.bs.popover', function() {
					$("#request_url").focus(function() {
					    var $this = $(this); $this.select();

					    // Work around Chrome's little problem
					    $this.mouseup(function() {
					        // Prevent further mouseup intervention
					        $this.unbind("mouseup");
					        return false;
					    });
					});
				});

				$('.navbar-brand').click(function() {
					api.typeSearch(7);
				});

				$('#input_search').focus(function() {
					if ($('#btn_search').hasClass('active')) {
						$('#btn_search').click();
					}
				});

				api.popoverOnBtn('#btn_search', function() {
					lemon.notes = [];
					lemon.defaults = [];
					lemon.tags = [];
					lemon.descs = [];
					api.previousInterval = {
				   		when: '',
				   		batch: 0
				    };
					var key = $('#input_search').val();
					//1 Just All API, 2 Normal Search, 3 Advance, 4 Tag, 5 Fav, 6 ALL History, 7 Settings
					var searchType = 1;
					var searchProp = '';
					if (!lemon.isBlank(key)) {
						searchType = 2;
						if (key.indexOf(':') > 0) {
							searchType = 3;
							var tmp = key.split(':');
							searchProp = tmp[0];
							key = tmp[1];
							if ('TAG' == searchProp) {
								searchType = 4;
							}
						} else {
							if ('FAV' == key) {
								searchType = 5;
							} else if ('ALL' == key) {
								searchType = 6;
							} else if ('SETTING' == key) {
								searchType = 7;
							}
						}
					}
					lemon.searchType = searchType;

					var regEx = new RegExp(key);
					var apis = {};
					var histories = {};

					switch (searchType) {
					case 1:
					case 2:
					case 3:
						var isAdvance = 3 == searchType;
						var justAllAPI = 1 == searchType;
						var items = api.preference.defines().items.sort(function(a, b) {
							return a.type.id - b.type.id;
						});
						
						lemon.each(items, function(v, k) {
							var r = {
								name: v.api,
								desc: v.desc,
								note: v.note,
								type: api.getInterfGroup(v.type.id),
								when: '',
								request: v.request,
								response: '',
								interf: ''
							};

							if (isAdvance) {
								if (regEx.test(lemon.json.get(v.request, searchProp))) {
									apis['api_' + v.api] = r;
								}
							} else {
								if (justAllAPI || regEx.test(v.api) || regEx.test(v.desc)) {
									apis['api_' + v.api] = r;
								}
							}
						});

						if (!justAllAPI) {
							lemon.store.forEach(function(k, v) {
								if (v && !lemon.isBlank(v.request)) {
									
									var r = api.nav.makeHis(v);
									if (isAdvance) {
										if (regEx.test(lemon.json.get(v.request, searchProp)) 
												|| regEx.test(lemon.json.get(v.response, searchProp))) {
											histories[k] = r;
										}
									} else {
										if (regEx.test(v.request.cmd) 
												|| regEx.test(r.desc) 
												|| regEx.test(api.customHis(k, 'note'))) {
											histories[k] = r;
										}
									}
								}
							});
						}
						break;

					case 4:	//Tag
						lemon.each(api.tag(), function(v, k) {
							if (lemon.isBlank(key)) {
								lemon.each(api.customHis(), function(v1, k1) {
									var hisTags = v1.tag || [];
									if (hisTags.length > 0) {
										var aHis = lemon.store(k1);
										if (aHis && aHis.request && aHis.request.cmd) {
											histories[k1] = api.nav.makeHis(aHis);
										}
									}
								});
							} else {
								if (regEx.test(decodeURI(v.name))) {
									var tagId = parseInt(v.id);
									lemon.each(api.customHis(), function(v1, k1) {
										var hisTags = v1.tag || [];
										if (hisTags.indexOf(tagId) != -1) {
											var aHis = lemon.store(k1);
											if (aHis && aHis.request && aHis.request.cmd) {
												histories[k1] = api.nav.makeHis(aHis);
											}
										}
									});
								}
							}
						});
						break;
					case 5:	//Fav
						lemon.each(api.customHis(), function(v, k) {
							if (v.fav && 1 == v.fav) {
								histories[k] = api.nav.makeHis(lemon.store(k));
							}
						});
						break;
					case 6:	//All
						/* lemon.store.forEach(function(k, v) {
							if (v && !lemon.isBlank(v.request)) {
								histories[k] = api.nav.makeHis(v);
							}
						}); */
						histories = api.getTrHis(1);
						break;

					case 7: //Settings
						return lemon.tmpl($('#setting_tmpl').html(), {});
					}

					//var empty = 'Couldnt find any APIs or histories';
					return lemon.tmpl($('#table_tmpl').html(), {
						histories: histories, 
						apis: apis, 
						theHisTrs: api.getTrHis(1, histories)
					});
				}, { title: '', trigger: 'click' }, function(el) {
					switch(lemon.searchType) {
					case 1:
					case 2:
					case 3:
						$('#btn_tgl_api').click(function() {
							$(el).button('toggle');
							$('pre[tgl-api="tgl"]').fadeToggle("slow", "linear");
						});
						$('#btn_tgl_interf').click(function() {
		                	$(el).button('toggle');
		                	lemon.each(api.preference.interf(), function(v, k) {
		                    	api.interfType(v.id);
		                    });
		                });
						break;
					case 7:
						$(el).data("bs.popover").tip().css({left:0});
						$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
							var curTab = e.target, prevTab = e.relatedTarget;
							api.preference.tab = {
								current: curTab,
								previous: prevTab
							};

							var curHref = $(curTab).attr('href');
							if ('#basic' == curHref) {
								api.mirrorVal('#p_interf', api.preference.interf());
								api.mirrorVal('#p_env', api.preference.env());
								api.mirrorVal('#p_config', api.preference.basic());
							} else if ('#server' == curHref) {
								var settingServerHtml = lemon.tmpl($('#setting_server_tmpl').html(), {});
								$('#server').empty().append(settingServerHtml);

								$('#server .thumbnail').hover(function(){  
									$(this).css({'background-color': '#fafafa'});   
								},function(){  
									$(this).css({'background-color': ''});   
								});
							}
						}).on('hide.bs.tab', function (e) {
							if (!api.preference.saveBasic()) {
								return false;
							}
						});
						break;
					};
				}, function(el) {
					switch(lemon.searchType) {
					case 7:
						lemon.mirror = {};
						api.preference.tab = {
							current: '',
							previous: ''
						};
						break;
					}
				});

				api.popoverOnBtn("#btn_history", function() {
					lemon.notes = [];
					lemon.descs = [];
					lemon.tags = [];
					lemon.currentP = 1;
					api.previousInterval = {
				   		when: '',
				   		batch: 0
				    };
                    return lemon.tmpl($('#table_tmpl').html(), {histories: 1, apis: {}, theHisTrs: api.getTrHis()});
                }, { title: '', trigger: 'click' }, function(el) {
                	$(el).data("bs.popover").tip().find('div .panel-body').attr({id: 'scroll_body'});
                    api.scroll('#scroll_body', function() {
                        ++lemon.currentP;
    					$('#his_body').append(api.getTrHis());
    					api.tglhis('#btn_tgl_requ', 'pre[tgl-requ="tgl"]');
    					api.tglhis('#btn_tgl_resp', 'pre[tgl-resp="tgl"]');
    					api.doHisFilter();
                    });
                });

				/* api.nav.textarea('#request');
				api.nav.textarea('#response'); */
				$('#request,#response').css({
					border: '0px solid #ffffff'
				});
				api.nav.dblclick('#request');
				api.nav.dblclick('#response');
				
				$('#request').change(function() {
					try { $(this).val(lemon.json($(this).val())); } 
					catch (e) { lemon.warn(e, 'Can not parse JSON string.'); }
					$('#request_url').text(api.nav.humanreadRequest());
				});
			},
			copyEncodeUrl: function() {
				if ($('#request_url').length) {
					$('#request_url').text(api.nav.humanreadRequest(true));
				}
			},
			makeHis: function(aHis) {
				var desc = (api.getAPI(aHis.request.cmd) || {desc: ''}).desc;
				return {
					when: aHis.when,
					request: aHis.request,
					response: aHis.response,
					interf: aHis.interf,
					name: desc
				};
			},
			dblclick: function(selector) {
				//forbiden right click context menu
				$(selector).bind('contextmenu', function() { 
					return false; 
				});
				
				//$(selector).dblclick(function(event) {
				$(selector).mousedown(function(event) {
					//1 left 2 middle 3 right
					if (event.which == 3) {
						event.preventDefault();
						if (lemon.endWith(selector, '_view')) {
							api.nav.edit(selector);
						} else {
							api.nav.view(selector);
						}
					}
				});
			},
			humanreadRequest: function(encode) {
				var cleanData = api.getCleanRequestData();
				var param = api.getRequestData(cleanData);
				param = lemon.json.reverse(param);
				var requestURL = api.nav.getRequestURLwithParams(param, encode);
				lemon.info(requestURL, 'Request URL');
				return requestURL;
			},
			getRequestURLwithParams: function(param, encode) {
				var curServ = api.env.which(lemon.getEnv());
				var requCfg = curServ.request || api.preference.basic().request;
				//1 wrap request data into a parameter ('paramName' value), 2 using lemon.getUrl eg: ?a=1&b=2
				switch(requCfg.type) {
				case 1:
					if (encode) {
						param = encodeURIComponent(param);
					}
					return lemon.format('{0}?{1}={2}', lemon.getEnv(), requCfg.paramName, param);
					
				case 2:
					return lemon.getUrl(lemon.getEnv(), $.parseJSON(param));
				}
			},
			textarea: function(selector, options) {
				api.popover(selector, function() {
					return [
						'<div class="btn-group btn-group-xs" role="group">',
						'<button type="button" class="btn btn-default" ',
						'onclick="api.nav.edit(\'' + selector + '\');">&nbsp;&nbsp;&nbsp;edit&nbsp;&nbsp;&nbsp;</button>',
						'<button type="button" class="btn btn-default" ',
						'onclick="api.nav.view(\'' + selector + '\');">&nbsp;&nbsp;&nbsp;view&nbsp;&nbsp;&nbsp;</button>',
						'</div>'
					].join('');
				}, lemon.extend({ 
					trigger: 'focus', placement: 'bottom' 
				}, options || {})).on('shown.bs.popover', function() { 
					var $parent = $(selector).parent();
					$parent.children('.popover').children('.arrow').removeClass('arrow');
					$parent.children('.popover').css({top: "-10px"});
				});
			},
			edit: function(elId) {
				if (lemon.endWith(elId, '_view')) {
					$(elId).popover('destroy').remove();
					$(lemon.rtrim(elId, '_view')).show();
				}
			},
			view: function(elId, reset) {
				if (lemon.endWith(elId, '_view')) {
					return;
				}

				var vid = elId + '_view';
				if (reset) {
					$(vid).remove();
				}
				
				var theVal = $(elId).val();
				if (lemon.isBlank(theVal)) {
					if (!reset) {
						return;
					}
				} else {
					try {
						JSON.parse(theVal);
					} catch (e) {
						lemon.warn(e, 'Can not parse JSON string');
						return;
					}
				}
				
				var height = $(elId).height() - 10;
				var width = $(elId).width();
				$(elId).hide();
				
				var html = [
					'<div class="panel panel-default" id="' + lemon.ltrim(vid, '#') + '" style="height:' + height + 'px;width:' + width + 'px;border:0px solid #ffffff;">',
					'<div class="panel-body"><pre style="border:0px solid #ffffff;background-color:#ffffff;height:' + (height - 20) + 'px;">',
					lemon.json.highlight(theVal),
					'</pre></div></div>'
				].join('');
				$(elId).parent().append(html);
				if (!after.styled) {
					api.nav.dblclick(vid, {
						trigger: 'click'
					});
				}
			},
		},
		typeSearch: function(type) {
			var val = '';
			switch (type) {
			case 1: break;
			case 4: val = 'TAG:'; break;
			case 5: val = 'FAV'; break;
			case 6: val = 'ALL'; break;
			case 7: val = 'SETTING'; break;
			}
			$('#input_search').val(val);
			if (4 != type) {
				$('#btn_search').click();
			}

			switch (type) {
			case 5:
			case 6:
			case 7: 
				$('#input_search').val('');
				break;
			}
		},
		scroll: function(selector, handle) {
			var prevContentH = 0;
			lemon.scrollNext = false;
			$(selector).scroll(function(){
		        var $this = $(this), viewH = $(this).height(),
		        contentH = $(this).get(0).scrollHeight, scrollTop = $(this).scrollTop();
		      	//when reach bottom 100px, if(contentH - viewH - scrollTop <= 100)
		        if(lemon.scrollNext || ((prevContentH != contentH) && (scrollTop / (contentH - viewH) >= 0.95))){ 
		        	lemon.scrollNext = false;
		        	prevContentH = contentH;
					lemon.isFunc(handle) && handle();
		        }
		     });
		},
		description: function(selector, cmd, onShown, onHidden, options) {
			api.popover(selector, function() {
				var cloneAPI = lemon.clone(api.getAPI(cmd || (api.getCleanRequestData() || {cmd : ''}).cmd));
				var note = cloneAPI.note;
				delete cloneAPI.note;
				var apiDefined = lemon.json.highlight(cloneAPI);
				return [
					api.showNote(note),
					'<pre style="width:500px;background-color:#ffffff;">' + apiDefined + '</pre>'
				].join('');
			}, lemon.extend({ 
				placement: 'right',
				title: 'API Description'
			}, options || {})).on('show.bs.popover', function() { 
				$(this).data("bs.popover").tip().css({
					maxWidth: (document.body.clientWidth / 2) + 200
				});
			}).on('shown.bs.popover', function() { 
				lemon.isFunc(onShown) && onShown();
			}).on('hidden.bs.popover', function() { 
				lemon.isFunc(onHidden) && onHidden();
			});
		},
		showNote: function(note) {
			if (lemon.isBlank(note)) {
				return '';
			}
			if (!lemon.isBlank(note)) {
				if (lemon.isFunc(note)) {
					return note();
				} else if (lemon.isArray(note)) {
					var html = ['<ul class="list-group">'];

					lemon.each(note, function(v, k) {
						html.push('<li class="list-group-item"><h6 class="text-muted">' + v + '</h6></li>');
					});
					
					html.push('</ul>');
					return html.join('');
				} else if (lemon.isJson(note)) {
					return '<pre title="Property Description">' + lemon.json.highlight(note) + '</pre>';
				} 
				else {
					return '<div class="panel panel-default"><div class="panel-body"><h6 class="text-muted">' + note + '</h6></div></div>';
				}
			}
		},
		historySortDesc: function(histories) {
			var items = [];
			lemon.each(histories, function(v, k) {
				if (v && !lemon.isBlank(v.request)) {
					v.k = k;
					v.api = v.request.cmd;
					items.push(v)
				}
			});
			return items.sort(function(a, b) {
				return b.k - a.k;
			});
		},
		getTrHis: function(pn, histories) {
			pn = pn || lemon.currentP;
        	var histories = histories || api.getHistories(pn);
        	var intlNo = (pn - 1) * api.preference.basic().history.pageSize + 1;
			return lemon.tmpl($('#his_tr_tmpl').html(), {histories: histories, intlNo: intlNo});
		},
		getHistories: function(pn) {
			var lastId = parseInt(lemon.store('last') || '0');
			var items = {}, ps = api.preference.basic().history.pageSize, pn = pn || 1, offset = (pn - 1) * ps;
			var startId = lastId - offset;
			
			for (var idx = 0; idx < ps; idx++) {
				var key = startId - idx, item = lemon.store(key);
				if (item && item.request && item.request.cmd) {
					var desc = (api.getAPI(item.request.cmd) || {desc: ''}).desc;
					items[key] = {
						when: item.when,
						request: item.request,
						response: item.response,
						interf: item.interf,
						name: desc
					};
				}
			}

			return items;
			//return lemon.store.getAll();
		},
		inlineTip: function(selector, msg, delay) {
			var tipSel = selector + ' .inlinetip';
			var isBtn = $(selector).get(0).tagName == 'BUTTON';
			if (!$(tipSel).length) {
				$(selector).append('<span class="inlinetip"></span>');
			}
			if (isBtn) {
				$(selector).attr({disabled: 'disabled'}).addClass('disabled');
			}
			$(tipSel).html(msg || ' done!');
			lemon.delay(function(){
				$(tipSel).empty();
				$(selector).removeAttr('disabled').removeClass('disabled');
			}, delay || 1500);
		},
		elhistag: function(hisId, tagId, tagName) {
			return '<span id="t_' + hisId + '_' + tagId + '">&nbsp;<span class="label label-success"> ' + tagName + ' </span></span>';
		},
		onhistag: function(hisId, tagId) {
			var id = '#tag_his_' + hisId + '_' + tagId;
			var hisTags = api.customHis(hisId, 'tag') || [];
			if (hisTags.indexOf(tagId) == -1) {
				hisTags.push(tagId);
				$(id).addClass('active');
				$('#tag_area_' + hisId).append(api.elhistag(hisId, tagId, $(id).text()));
				$('#' + hisId).attr('tag' + tagId, tagId);
			} else {
				lemon.rmByVal(hisTags, tagId);
				$(id).removeClass('active');
				$('#t_' + hisId + '_' + tagId).remove();
				$('#' + hisId).removeAttr('tag' + tagId).hide();
			}
			api.customHis(hisId, 'tag', hisTags);
		},
		tag: function(tagId, tagName) {
			var key = "definedTag";
			var tags = lemon.store(key) || {};
			if (lemon.isUndefined(tagId)) {
				return tags;
			}

			var aTag = tags[tagId] || {};
			if (lemon.isUndefined(tagName)) {
				if (lemon.isBlank(aTag)) {
					return aTag;
				}
				
				aTag.name = decodeURI(aTag.name);
				return aTag;
			}

			var existsTag = 1;
			var encodeTagName = encodeURI(tagName);
			if (-1 == tagName) {
				delete tags[tagId];
				lemon.store(key, tags);
				return aTag;
			} else {
				lemon.each(tags, function(v, k) {
					if (encodeTagName == v.name) {
						existsTag = 2;
						aTag = v;
					}
				});
			}

			if (1 == existsTag) {
				tags[tagId] = {
					id: tagId,
					name: encodeTagName
				};
				lemon.store(key, tags);
				return {
					id: tagId,
					name: tagName
				};
			}

			aTag.exists = true;
			return aTag;
		},
		defaultValue: function(cmd, val) {
			var key = "defaultApiVal";
			var hold = lemon.store(key) || {};
			if (lemon.isUndefined(cmd)) {
				return hold;
			}

			var defaultCmdVal = hold[cmd] || {};
			if (lemon.isUndefined(val)) {
				return hold[cmd];
			}

			hold[cmd] = val;
			lemon.store(key, hold);
			return hold[cmd];
		},
		customHis: function(hisId, key, val, rmVal) {
			var defineHisKey = 'definehis';
			var cust = lemon.store(defineHisKey) || {};
			if (lemon.isUndefined(hisId)) {
				return cust;
			}

			var tmp = cust[hisId] || {};
			if (lemon.isUndefined(key)) {
				return tmp;
			}
			
			if (lemon.isUndefined(val)) {
				return tmp[key];
			} else if (-1 == val) {
				if (lemon.isUndefined(rmVal)) {
					delete tmp[key];
					lemon.store(defineHisKey, cust);
					return tmp;
				} else {
					var aVal = tmp[key];
					if (lemon.isBlank(aVal)) {
						return aVal;
					}
					if (lemon.isArray(aVal)) {
						aVal = lemon.rmByVal(aVal, rmVal);
						lemon.store(defineHisKey, cust);
						return aVal;
					} else {
						delete aVal[rmVal];
						lemon.store(defineHisKey, cust);
						return aVal;
					}
				}
			} else {
				tmp[key] = val;
				cust[hisId] = tmp;
				lemon.store(defineHisKey, cust);
			}
			return cust[hisId];
		},
		setAPIDefaultValClose: function(theAPI) {
			$('#set_default_' + theAPI).popover('hide');
		},
		setAPIDefaultVal: function(theAPI) {
			var apiDefaultId = '#set_default_' + theAPI;
			var title = [
			 	theAPI + ' Default Value',
			 	'<div class="pull-right">',
			 	'<button type="button" class="close" aria-label="Close" onclick="api.setAPIDefaultValClose(\'' + theAPI + '\');">',
			 	'<span aria-hidden="true">&times;</span></button>',
			 	'</div>'
			 ].join('');
			 
			if (lemon.defaults.indexOf(theAPI) == -1) {
				api.popover(apiDefaultId, function() {
					var apiVal = lemon.json(api.getAPIDefaultVal(theAPI, api.getAPI(theAPI).request));
					return '<textarea id="api_default_edit_' + theAPI + '" style="height:300px;width:500px;border:0px solid #ffffff;">' + apiVal + '</textarea>';
				}, { 
					title: title, placement: 'left'
				}).on('shown.bs.popover', function() {
					if (after.styled) {
						after[theAPI] = after.mirror('#api_default_edit_' + theAPI, {
							width: 500,
							height: 305
						});
					}
				}).on('show.bs.popover', function() { 
					$(this).data("bs.popover").tip().css({
						maxWidth: (document.body.clientWidth / 2) + 200
					});
					$(apiDefaultId).addClass('active');
				}).on('hidden.bs.popover', function() {
					$(apiDefaultId).removeClass('active');
				}).on('hide.bs.popover', function() {
					var data = $('#api_default_edit_' + theAPI).val();
					if (after.styled) {
						data = after[theAPI].getValue();
						after[theAPI] = null;
					}
					if (!lemon.isBlank(data)) {
						data = $.parseJSON(data || {});
						var cmd = data.cmd;
						if (cmd) {
							api.defaultValue(cmd, data);
						}
					}
				});

				lemon.defaults.push(theAPI);
				$(apiDefaultId).popover('show');
			}
		},
		itemTag: function(hisId, no) {
			var tagBtnId = '#tags_' + hisId;
			var title = [
			 	'Tags <span class="badge">' + no + '</span>',
			 	'<div class="pull-right">',
			 	'<button type="button" class="close" aria-label="Close" onclick="api.itemTagClose(' + hisId + ');">',
			 	'<span aria-hidden="true">&times;</span></button>',
			 	'</div>'
			 	].join('');
			if (lemon.tags.indexOf(hisId) == -1) {
				api.popover(tagBtnId, function() {
			  		var html = [
						'<div style="height:300px;width:500px;overflow-y:auto;">'
						];
			  		var hisTags = api.customHis(hisId, 'tag') || [];

			  		var definedTags = api.tag();
			  		lemon.each(definedTags, function(v, k) {
						var tagName = decodeURI(v.name);
						var aTag = [
								' <button type="button" onclick="api.onhistag(' + hisId + ','+ v.id + ');"',
								' class="btn btn-default ' + ((hisTags.indexOf(v.id) > -1) ? 'active' : '') + '" style="margin-top:5px;" ',
								' id="tag_his_' + hisId + '_' + v.id + '"> ' + tagName + ' </button> '
                            	].join('');
                    	html.push(aTag);
					});

					if (lemon.isBlank(definedTags)) {
						return '<div style="width:500px" class="alert alert-info" role="alert">No tag defined.</div>';
					}
					html.push('</div>');
			  		
					return html.join('');
				}, { 
					title: title,
					placement: 'left'
				}).on('show.bs.popover', function() {
					$(this).data("bs.popover").tip().css({
						maxWidth: (document.body.clientWidth / 2) + 200
					});
				}).on('shown.bs.popover', function() {
					$(tagBtnId).addClass('active');
				}).on('hidden.bs.popover', function() {
					$(tagBtnId).removeClass('active')
				}).on('hide.bs.popover', function() {
					
				});
				lemon.tags.push(hisId);
				$(tagBtnId).popover('show');
			}
		},
		itemTagClose: function(hisId) {
			$('#tags_' + hisId).popover('hide');
		},
		hisTglRequResp: function(hisId, type) {
			switch (type) {
			case 1: type = 'requ'; break;
			case 2: type = 'resp'; break;
			case 3: type = 'api'; break;
			}
			var id = lemon.format('#his_tgl_{0}_{1}', type, hisId);
			if (3 == type) {
				id = hisId;
			}
			$(id).button('toggle');
			$(lemon.format('#{0} pre[tgl-{1}="tgl"]', hisId, type)).fadeToggle("slow", "linear");
		},
		historyAPIDesc: function(hisId, cmd) {
			var descId = '#desc_' + hisId;
			if (lemon.descs.indexOf(hisId) == -1) {
				api.description(descId, cmd, function() {
					$(descId).addClass('active');
				}, function() {
					$(descId).removeClass('active');
				}, {placement: 'left'});
				lemon.descs.push(hisId);
				$(descId).popover('show');
			}
		},
		pencil: function(hisId, no) {
			var pencilId = '#pencil_' + hisId;
			var title = [
			 	'Note <span class="badge">' + no + '</span>',
			 	'<div class="pull-right">',
			 	'<span class="glyphicon glyphicon-trash" title="Clean Note" onclick="api.pencilClose(' + hisId + ', 1);"></span>',
			 	'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;',
			 	'<button type="button" class="close" aria-label="Close" onclick="api.pencilClose(' + hisId + ');">',
			 	'<span aria-hidden="true">&times;</span></button>',
			 	'</div>'
			 	].join('');
			if (lemon.notes.indexOf(hisId) == -1) {
				api.popover(pencilId, function() {
			  		var html = [
							'<textarea id="his_note_' + hisId + '" style="border:0px solid #ffffff;height:150px;width:500px"></textarea>',
						].join('');
					
					return html;
				}, { 
					title: title,
					placement: 'left'
				}).on('show.bs.popover', function() {
					$(this).data("bs.popover").tip().css({
						maxWidth: (document.body.clientWidth / 2) + 200
					});
				}).on('shown.bs.popover', function() {
					$(pencilId).addClass('active');
					var note = api.customHis(hisId, 'note') || '';
					$('#his_note_' + hisId).val(note);
				}).on('hidden.bs.popover', function() {
					$(pencilId).removeClass('active');
				}).on('hide.bs.popover', function() {
					var note = $('#his_note_' + hisId).val() || '';
					api.customHis(hisId, 'note', note);
					
					var showNoteId = '#show_note_' + hisId;
					if (!lemon.isBlank(note)) {
						$(showNoteId).html('<div class="alert alert-warning" role="alert" id="">' + note + '</div>');
					} else {
						$(showNoteId).empty();
					}
				});
				lemon.notes.push(hisId);
				$(pencilId).popover('show');
			}
		},
		pencilClose: function(hisId, trash) {
			$('#pencil_' + hisId).popover('hide');
			if (1 == trash) {
				api.customHis(hisId, 'note', '');
				$('#show_note_' + hisId).empty();
			}
		},
		favourite: function(el, hisId) {
			var $span = $(el).children('span');
			var isFavShow = $('#prop_filter_1').hasClass('active');
            //unfav
            if ($span.hasClass('glyphicon-star')) {
                $span.removeClass('glyphicon-star');
                $span.addClass('glyphicon-star-empty');
                api.customHis(hisId, 'fav', 0);
                if (isFavShow) {
                    $('#' + hisId).attr({prop: 0}).fadeToggle("slow", "linear");
                }
            } 
            //fav
            else {
            	$span.removeClass('glyphicon-star-empty');
                $span.addClass('glyphicon-star');
				api.customHis(hisId, 'fav', 1);
				$('#' + hisId).attr({prop: 1});
            }
		},
		tglhis: function(selector, tglTarget) {
			var isActive = $(selector).hasClass('active');
			if (isActive) {
				$(tglTarget).hide("slow", "linear");
			} else {
				$(tglTarget).show("slow", "linear");
			}
			
		},
		popoverOnBtn: function(selector, content, options, onShown, onHidden) {
			api.popover(selector, content, options)
			  .on('show.bs.popover', function() { 
				$(this).data("bs.popover").tip().css({maxWidth: "100%"});
				$(selector).button('toggle');
			}).on('hide.bs.popover', function() {
				switch(lemon.searchType) {
				case 7:
					if (!api.preference.saveBasic()) {
						return false;
					}
				}
				$(selector).button('toggle');
			}).on('hidden.bs.popover', function() {
				lemon.isFunc(onHidden) && onHidden(this);
			}).on('shown.bs.popover', function() {
				lemon.isFunc(onShown) && onShown(this);

				$('#btn_tgl_requ').click(function() {
					$(this).button('toggle');
					lemon.scrollNext = true;
					api.tglhis(this, 'pre[tgl-requ="tgl"]');
				});
				$('#btn_tgl_resp').click(function() {
					$(this).button('toggle');
					lemon.scrollNext = true;
                	//$('pre[tgl-resp="tgl"]').fadeToggle("slow", "linear");
					api.tglhis(this, 'pre[tgl-resp="tgl"]');
                });
                $('#btn_tgl_interval').click(function() {
                	$(this).button('toggle');
                	var isActive = $(this).hasClass('active');
                	lemon.each(api.batches || [], function(v, k) {
                		var exp = api.getHisFilterExp();
                		var target = '';
            			if (!lemon.isBlank(exp)) {
            				target = 'tr[batch="' + v + '"]' + exp;
            			} else {
                			target = 'tr[batch="' + v + '"]';
            			}
            			if (isActive) {
            				$(target).hide("slow", "linear");
                		} else {
                			$(target).show("slow", "linear");
                    	}
                    });
                });

                $('#tag_edit').click(function() {
                	var $input = $('#tag_input');
                	var tagId = $input.attr('tagId');
                	var msg = '';
                	var tagNmae = $input.val();
                	if (tagId && !lemon.isBlank(tagNmae)) {
	                    var id = '#tag_filter_' + tagId;
	                    api.tag(tagId, tagNmae);
	                    $(id).text(tagNmae);
	                    msg = ' Edit Done!';
	                    $('span[id$=' + tagId + ']').children('span').text(tagNmae);
                    } else {
                        msg = ' None Exist Tag.';
                    }
                	api.inlineTip('#tag_edit', msg);
                });
                $('#tag_add').click(function() {
                    $(this).button('disable');
                    var $input = $('#tag_input');
                    var $group = $('#tag_group');
                    var tag = $input.val();
                    if (!lemon.isBlank(tag)) {
                        var tagId = api.autoId();
                        var theTag = api.tag(tagId, tag);
                        var msg = '';
                        if (!theTag.exists) {
                            var tagBtn = [
								' <button type="button" onclick="api.ontag('+ tagId + ');"',
								' class="btn btn-default btn-sm" style="margin-top:5px;" ',
								' id="tag_filter_'+ tagId + '"> ' + tag + ' </button> '
                            	].join('');
	                        $group.append(tagBtn);
	                        $input.attr({tagId: theTag.id});
	                        msg = ' Add Done!';
                        } else {
                            msg = ' Tag Exists.';
                        }
                        
                        api.inlineTip('#tag_add', msg);
                    }
                });
                $('#tag_rem').click(function() {
                	var $input = $('#tag_input');
                	var tagId = $input.attr('tagId');
                	var msg = '';
                	if (tagId) {
	                    var id = '#tag_filter_' + tagId;
	                    api.tag(tagId, -1);
	                    $(id).remove();
	                    $input.removeAttr('tagId');
	                    msg = ' Remove Done!';

	                    $('span[id$=' + tagId + ']').remove();
	                    $(lemon.format('[tag{0}="{0}"]', tagId)).removeAttr('tag' + tagId).hide();
	                    api.filters.tag = lemon.rmByVal(api.filters.tag, parseInt(tagId));
	                    api.doHisFilter();
                    } else {
                        msg = ' None Exist Tag.';
                    }
                	api.inlineTip('#tag_rem', msg);
                });

                api.filters = {
                	env: [],
                	interf: [],
                	prop: [],
                	tag: []
                };
                $('button[id^="env_filter_"],button[id^="filter_"],button[id^="prop_filter_"]').click(function() {
					var isActive = $(this).hasClass('active');
					var id = $(this).attr('id');
					var mark = lemon.ltrim(id, 'env_filter_|filter_|prop_filter_');
					
					var whichGroup = 0;
					var expTpl = '';
					if (lemon.startWith(id, 'env_filter_')) {
						whichGroup = 1;
						expTpl = '[env="{0}"]';
					} else if (lemon.startWith(id, 'filter_')) {
						whichGroup = 2;
						expTpl = '[interf="{0}"]';
					} else if (lemon.startWith(id, 'prop_filter_')) {
						whichGroup = 3;
						expTpl = '[prop="{0}"]';
					}
					
					$(this).button('toggle');
					if (isActive) {
						switch (whichGroup) {
						case 1:
							api.filters.env.pop();
							break;
						case 2:
							api.filters.interf.pop();
							break;
						case 3:
							api.filters.prop.pop();
							break;
						}
					} else {
						switch (whichGroup) {
						case 1:
							if (api.filters.env.length > 0) {
								$('#env_filter_' + api.filters.env.pop()).button('toggle');
							}
							api.filters.env.push(mark);
							break;
						case 2:
							if (api.filters.interf.length > 0) {
								$('#filter_' + api.filters.interf.pop()).button('toggle');
							}
							api.filters.interf.push(mark);
							break;
						case 3:
							if (api.filters.interf.length > 0) {
								$('#prop_filter_' + api.filters.prop.pop()).button('toggle');
							}
							api.filters.prop.push(mark);
							break;
						}
					}
					
					api.doHisFilter();
				});
			});
		},
		getHisFilterExp: function() {
			var exp = [
				(api.filters.env.length > 0 ? lemon.format('[env="{0}"]', api.filters.env[0]) : ''),
				(api.filters.interf.length > 0 ? lemon.format('[interf="{0}"]', api.filters.interf[0]) : ''),
				(api.filters.prop.length > 0 ? lemon.format('[prop="{0}"]', api.filters.prop[0]) : '')
			];

			lemon.each(api.filters.tag, function(tagId, k) {
				exp.push(lemon.format('[tag{0}={0}]', tagId));
			});

			return exp.join('');
		},
		doHisFilter: function() {
			var filterExp = api.getHisFilterExp();
			lemon.info(filterExp, 'History filter expression');
			$('tr[his="1"]').show();
			if (!lemon.isBlank(filterExp)) {
				$('tr[his="1"]:not(' + filterExp + ')').hide();
			}
		},
		ontag: function(tagId) {
			var id = '#tag_filter_' + tagId;
			var aTag = api.tag(tagId);
			var $input = $('#tag_input');
            $input.val(aTag.name).attr({tagId: aTag.id});

            var isActive = $(id).hasClass('active');
            if (isActive) {
            	api.filters.tag = lemon.rmByVal(api.filters.tag, tagId);
            } else {
            	api.filters.tag.push(tagId);
            }
            $('#tag_filter_' + tagId).button('toggle');

            api.doHisFilter();
		},
		popover: function(selector, content, options) {
			var popoverTemplate = [
           		'<div class="popover" role="tooltip">',
           		'<div class="arrow"></div>',
           		'<h3 class="popover-title"></h3>',
           		'<div class="popover-content"></div>',
           		'</div>'
            ].join('');
            
			var thePopover = $(selector).popover(lemon.extend({
                title: '',
                trigger: 'click',
                content: content,
                template: popoverTemplate,
                placement: "bottom",
                html: true
            }, options || {}))
            
			return thePopover;
		},
		autoId: function(key) {
			key = key || 'autoid';
			return lemon.store.set(key, parseInt(lemon.store.get(key) || 0) + 1);
		},
		uniqueId: function() {
			var historySize = api.preference.basic().history.max;
			var maxId = lemon.store.set('last', parseInt(lemon.store.get('last') || 0) + 1);
			if (historySize > 0 && maxId >= historySize) {
				lemon.store.forEach(function(k) {
					if (k <= (maxId - historySize + 1)) {
						lemon.store(k, null);
					}
				});
			}
			return maxId;
		},
		chkRequest: function() {
			if (null == lemon.getEnv()) {
				api.tip('Choose an environment first!');
				return false;
			}

			if (lemon.isBlank(api.requ())) {
				api.tip('Choose or define an API first!');
				return false;
			}

			if (api.env.isProduct()) {
				var toBeContinue = confirm('Are you sure?\nProduct Environment!');
				if (!toBeContinue) {
					return false;
				}
			}
			
			return true;
		},
		getCleanRequestData: function(data) {
			var data = api.requ();
			if (lemon.isBlank(data)) {
				lemon.warn(data, 'request params is not valid.');
				return {};
			}
			
			try {
				return $.parseJSON(data || {});
			} catch(e) {
				api.tip(lemon.asStr(e.message));
				throw e;
			}
		},
		getRequestData: function(data) {
			data = lemon.clone(data || {});
			var env = api.env.which(lemon.getEnv());
			if (!lemon.isBlank(env.params)) {
				lemon.extend(data, env.params);
			}
			return data;
		},
		getHoverOrSelectItem: function(key) {
			var result = {};
			if (lemon.isUndefined(key)) {
				return result;
			}
			
			if (lemon.startWith(key, 'api_')) {
				result = api.getAPI(key.replace('api_', ''));
			} else {
				result = lemon.store(key) || {};
			}

			return result;
		},
		getInterfGroup: function(id) {
			var r = {};
			lemon.each(api.preference.interf(), function(v, k) {
				if (id == v.id) {
					r = v;
					return false;
				}
			});
			return r;
		},
		getAPI: function(theAPI) {
			var result = {};
			lemon.each(api.preference.defines().items, function(v, k) {
				if (v.api === theAPI) {
					result = v;
					result.type = api.getInterfGroup(v.type.id);
					return false;
				}
			});
			return result;
		},
		getAPIDefaultVal: function(theAPI, defaultVal) {
			var dv = api.defaultValue(theAPI)
			return lemon.isBlank(dv) ? defaultVal : dv;
		},
		interval: function(batch) {
			var exp = api.getHisFilterExp();
			if (!lemon.isBlank(exp)) {
				$('tr[batch="' + batch + '"]' + exp).fadeToggle("slow", "linear");
			} else {
				$('tr[batch="' + batch + '"]').fadeToggle("slow", "linear");
			}
	
		},
		interfType: function(type) {
			$('[type="' + type + '"]').fadeToggle("slow", "linear");
		},
		onSelectSinleClick: function(el) {
			var key = $(el).button('toggle').attr('clkey');
			api.hisTglRequResp(key, 1);
			api.hisTglRequResp(key, 2);
		},
		onSelect: function(key) {
			var item = api.getHoverOrSelectItem(key);
			if (!lemon.isBlank(item)) {
				if (lemon.startWith(key, 'api_')) {
					var requestV = item.request || {};
					if (requestV.cmd) {
						requestV = api.getAPIDefaultVal(requestV.cmd, requestV);
					}
					api.requ(lemon.json(requestV));
					api.resp(item.response);
					$("#btn_search").click();
				} else {
					api.requ(lemon.json(item.request || {}));
					api.resp(lemon.json(item.response || {}));
					lemon.setEnv(item.interf);
					api.env.change(item.interf);
					if ($('#btn_history').hasClass('active')) {
						$('#btn_history').click();
					}
					if ($('#btn_search').hasClass('active')) {
						$('#btn_search').click();
					}
				}
				
				lemon.setApi(item.request.cmd);

				if (after.styled) {
					
				} else {
					if (!$('#request:visible').length) {
						api.nav.view('#request', true);
					}
					api.nav.view('#response', true);
				}
			}
		},
		mirrorVal: function(selector, value, options) {
			var theK = lemon.ltrim(selector, '#'); lemon.mirror = lemon.mirror || {};
			if (lemon.isUndefined(value)) {
				if (after.styled) {
					if (lemon.mirror[theK]) {
						return lemon.mirror[theK].getValue();
					}
					return {};
				}

				return $(selector).val();
			} else {
				value = lemon.json(value);
				if (after.styled) {
					lemon.mirror[theK] = lemon.mirror[theK] || after.mirror(selector, lemon.extend({
						width: 358,
						height: 360
					}, options || {}));
					
					return lemon.mirror[theK].setValue(value);
				}

				return $(selector).val(value);
			}
		},
		requ: function(data) {
			var requId = '#request';
			if (lemon.isUndefined(data)) {
				if (after.styled) {
					return after.request.getValue();
				}
				
				return $(requId).val();
			}

			if (after.styled) {
				after.request.setValue(lemon.isNull(data) ? '' : data);
				return data;
			}

			$(requId).val(data);
			return data;
		},
		resp: function(data) {
			var respId = '#response';
			if (lemon.isUndefined(data)) {
				if (after.styled) {
					return after.response.getValue();
				}
				
				return $(respId).val();
			}

			if (after.styled) {
				after.response.setValue(lemon.isNull(data) ? '' : data);
				return data;
			}

			$(respId).val(data);
			return data;
		},
		requestGetPost: function(selector, type) {
			$(selector).click(function() {
				if ($(selector).parent().hasClass('disabled')) {
					return;
				}
				if (!api.chkRequest()) { return; }
									
				$('#btn_request').button('loading');
				$(selector).parent().addClass('disabled');
				api.resp('');
				api.request(function(data) {
					api.resp(lemon.json(data));
					$('#btn_request').button('reset');
					$(selector).removeClass('disabled');
				}, function(jqXHR, textStatus, errorThrown) {
					$(selector).parent().removeClass('disabled');
				}, type || 'post');
			});
		},
		request: function(success, failure, type) {
			var cleanData = api.getCleanRequestData();
			var request = api.getRequestData(cleanData);
			lemon.info(request, 'request');

			var done = function(data, textStatus, jqXHR) {
	           	 lemon.info(textStatus, 'request status');
	        	 lemon.info(data, 'response');
	        	 lemon.store.set(api.uniqueId(), {
	 				when: lemon.when(),
	 				request: cleanData, 
	 				response: data,
	 				interf: lemon.getEnv(),
	 				name: api.getAPI(cleanData.cmd).desc
	 			 });
		         success && success(data);
		         if (!after.styled) {
		        	 api.nav.view('#response', true);
			     }
		     };

		     type = type || 'jsonp';
		     var url = lemon.getEnv(), curServ = api.env.which(url), rdata = {};
			 var requCfg = curServ.request || api.preference.basic().request;
		     rdata[requCfg.paramName] = lemon.json.reverse(request);
		     var fail = function(jqXHR, textStatus, errorThrown){  
            	 lemon.error(jqXHR);
            	 lemon.error(textStatus, 'request status');
            	 lemon.error(errorThrown);
            	 
            	 api.resp(lemon.json({
                	 title: 'Request Failed (' + type.toUpperCase() + ')',
                	 cause: ((!lemon.startWith(location.href, url) && (type != 'jsonp'))
                	 	? 'May cross domain issue. ' : '') + 'See browser console for more information',
                	 jqXHR: jqXHR,
                	 textStatus: textStatus,
                	 errorThrown: errorThrown,
                	 server: url
               	 }));
            	 $('#btn_request').button('reset');
            	 failure && failure(jqXHR, textStatus, errorThrown);
             }

			switch (type) {
			case 'jsonp':
				$.ajax({  
		             type: "get",
		             async: false,
		             url: url,
		             data: rdata,
		             dataType: "jsonp" 
		        }).done(done).fail(fail);
				break;

			case 'get':
				$.get(url, rdata).success(done).error(fail);
				break;

			case 'post':
				$.post(url, rdata).success(done).error(fail);
				break;
			}
		},
		attention: function(selector, duration, times) {
			lemon.times(times || 4, function() {
				$(selector).fadeToggle(duration || 500);
			});
		},
		tip: function(text, options) {
			options = lemon.extend({
				//1 main page, 2 settings page
				where: 1,
				level: 'warning',
				delay: 3000,
				//auto: disappear when options.delay millesecond, manual: manual close
				close: 'auto'
			}, options || {});

			var tipId = '#tip_id_' + options.where + lemon.uniqueId(), msgId = '#msg_id';
			var msg = $(document.createElement('div')).attr({
				class: 'alert alert-' + options.level,
				role: 'alert',
				id: lemon.ltrim(tipId, '#'),
				style: 'display:none'
			}).html(text);

			switch (options.where) {
			case 1:
				$('#message').append(msg);
				$(msgId).slideToggle();  
				break;
			case 2:
				$('#message_settings').append(msg);
				break;
			}
			
			if (options.close == 'manual') {
				msg.append([
					'<button type="button" class="close" data-dismiss="alert" aria-label="Close">',
					'<span aria-hidden="true">&times;</span></button>'
				].join(''));
			};

			$(tipId).slideToggle();
			if (options.close == 'auto') {
				lemon.delay(function() {
					if (1 == options.where) {
						$(msgId).slideToggle(); 
					}
					$(tipId).slideToggle(function() {
						$(tipId).remove();
					});
				}, options.delay);
			}
		},
		msg: function(type, text, title) {
			var msg = $(document.createElement('div')).attr({
				class: 'alert alert-' + type || 'info',
				role: 'alert',
				env: title,
				id: 'msg_id'
			}).text(text);
			$('#message').empty().append(msg).popover({
				content: function() {
					return $('#msg_id').attr('env');
				},
				placement: 'bottom',
				trigger: 'hover'
			}).on('show.bs.popover', function() { 
				$(this).data("bs.popover").tip().css({maxWidth: "800px"});
			});
			return msg;
		},
		preference: {
			tab: {
				current: '',
				previous: ''
			},
			valid: {
				basic: { 
					"{{Group name}}" : {
						id: "", 
						name: "" 
					}
				},
				env: { 
					environment: [ 
						{ 
							env: "", 
							desc: "" 
						} 
					]
				},
				serv: {
					id: "",
					interf: "[string, request url]",
					note: "[string|string array|JSON]",
					params: "[JSON optional, add to request parameters] ",
					request: {
						type: "[number, 1 wrap request data into a parameter ('paramName' value), 2 using lemon.getUrl eg: ?a=1&b=2]",
						paramName: "[string, if type is 1 then must provide]"
					},
					asDefault: "[number optional, 1 set default]"
				}
			},
			saveBasic: function() {
				if ($(api.preference.tab.current).attr('href') == '#basic') {
					var step = 'Interface Group';
					try {
						var theErr = '', theInterf = {};
						var theInterfs = $.parseJSON(api.mirrorVal('#p_interf')), ids = [];
						lemon.each(theInterfs, function(v, k) {
							if (v && v.id && v.name) {
								if (ids.indexOf(v.id) == -1) {
									theInterf[k] = v;
									ids.push(v.id);
								} else {
									theErr = 'the id ' + v.id + ' is duplicated';
									return false;
								}
							} else {
								var theV = {};
								theV[k] = v;
								theErr = api.preference.getWarn(api.preference.valid.basic, theV);
								return false;
							}
						});
						if (!lemon.isBlank(theErr)) {
							api.preference.tip(step, theErr);
							return false;
						}
						api.preference.interf(theInterf);
						
						step = 'Environment';
						var theEnvs = $.parseJSON(api.mirrorVal('#p_env')).environment;
						var theEnv = {}; theErr = '', valid = api.preference.valid.env, envs = [];
						if (!theEnvs) {
							api.preference.tip(step, api.preference.getWarn(valid));
							return false;
						}
						var theDefinedService = api.preference.service();
						lemon.each(theEnvs, function(v, i) {
							if (v && v.env && v.desc) {
								if (envs.indexOf(v.env) == -1) {
									var r = {
										env: v.env,
										desc: v.desc
									};
									if (theDefinedService[v.env]) {
										r.serv = theDefinedService[v.env].serv;
									} else {
										r.serv = [];
									}
									theEnv[v.env] = r;
									envs.push(v.env);
								} else {
									theErr = 'the env ' + v.env + ' is duplicated';
									return false;
								}
							} else {
								theErr = api.preference.getWarn(valid, {environment:[v]});
								return false;
							}
						});
						if (!lemon.isBlank(theErr)) {
							api.preference.tip(step, theErr);
							return false;
						}
						api.preference.service(theEnv);

						step = 'Configuration';
						var theConfig = $.parseJSON(api.mirrorVal('#p_config'));
						api.preference.basic(theConfig);
					} catch(e) {
						api.preference.tip(step, ' invalid JSON value, ' + e.message);
						return false;
					}
				}
				
				return true;
			},
			getWarn: function(valid, wrong) {
				var msg = [
					'<div class="row">'
				];

				if (valid) {
					msg.push('<div class="col-md-6"><pre style="background-color:#ffffff;border:0px;">');
					msg.push('<p class="text-success">the legal structure</p>' + lemon.json.highlight(valid) + '</pre></div>');
				}

				if (wrong) {
					msg.push('<div class="col-md-6"><pre style="background-color:#ffffff;border:0px;">');
					msg.push('<p class="text-danger">below is illegal structure</p>' + lemon.json.highlight(wrong) + '</pre></div>');
				}

				msg.push('</div>');
				return msg.join('');
			},
			tip: function(title, msg) {
				/* api.tip(msg, lemon.extend({
					close:'manual',
					where:2
				}, options || {})); */
				
				var html = [
					'<div class="alert alert-warning alert-dismissible fade in" role="alert">',
				    '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true"></span></button>',
				    '<h5>' + (title || 'Oh snap! You got an error!') + '</h5>',
				    '<p>' + (msg || '') + '</p>',
				    '</div>'
				].join('');
				$('#message_settings').append(html);
			},
			basic: function(preference) {
				return api.preference.val('basic', preference);
			},
			interf: function(preference) {
				return api.preference.val('interf', preference);
			},
			env: function(preference) {
				var env = {
					environment: []
				};
				lemon.each(api.preference.service(), function(v, k) {
					env.environment.push({
						env: v.env,
						desc: v.desc
					});
				});
				return env;
			},
			service: function(preference) {
				return api.preference.val('service', preference);
			},
			defines: function(preference) {
				return api.preference.val('defines', preference);
			},
			val: function(key, val) {
				var preference = 'preference';
				var preferences = lemon.store(preference) || {};
				if (lemon.isUndefined(key)) {
					return preferences;
				}

				var defined = preferences[key] || {};
				if (lemon.isUndefined(val)) {
					return defined;
				}

				preferences[key] = lemon.extend(defined, val);
				lemon.store(preference, preferences);
				return preferences[key];
			},
			isExists: function(obj, key, target) {
				for (var i = obj.length - 1; i >= 0; i--) {
					if (obj[i][key] == target[key]) {
						return true;
					}
				};
				
				return false;
			}
		},
		env: {
			servSortEsc: function(items) {
				return items.sort(function(a, b) {
					return a.type.id - b.type.id;
				});
			},
			load: function() {
				var theDefined = null;
				if (root.config) {
					theDefined = api.preference.basic();
					lemon.each(config, function(v, k) {if (!theDefined[k]) {theDefined[k] = v; } });
					api.preference.basic(theDefined);
					theDefined = null, config = undefined;
				}
				
				if (root.interf) {
					theDefined = api.preference.interf();
					lemon.each(interf, function(v, k) {if (!theDefined[k]) {theDefined[k] = v; } });
					api.preference.interf(theDefined);
					theDefined = null, interf = undefined;
				}
				
				if (root.definedServs) {
					theDefined = api.preference.service();
					lemon.each(root.definedServs, function(env, idx) {
						if (theDefined[env.env]) {
							var servs = theDefined[env.env].serv || [];
							lemon.each(env.serv, function(service, idx2) {
								if (!api.preference.isExists(servs, 'id', service)) {
									servs.push(service);
								}
							});
							theDefined[env.env].serv = servs;
						} else {
							theDefined[env.env] = env;
						}
					});
					api.preference.service(theDefined);
					theDefined = null, definedServs = undefined;
				}

				if (root.definedAPIs) {
					theDefined = api.preference.defines();
					var apis = theDefined.items || [];
					lemon.each(definedAPIs.items, function(item, k) {
						if (!api.preference.isExists(apis, 'api', item)) {
							apis.push(item);
						}
					})
					theDefined.items = apis;
					api.preference.defines(theDefined);
					theDefined = null, definedAPIs = undefined;
				}
			},
			render: function() {
				api.env.load();
				var $env = $('#which_env'); $env.empty();
				
				lemon.each(api.preference.service(), function(envGroup, k) {
					var isProduct = 'PRODUCT' === envGroup.env;
					var clazz = isProduct ? 'danger' : 'info';
					var title = [
						'<li role="presentation" class="dropdown-header"><h4>',
						'<span class="label label-' + clazz + '">' + envGroup.desc + '</span>',
						'</h4></li>'
						].join('');
					
					var presentation = $(document.createElement('li')).attr({ 
						role:'presentation', 
						class:'divider' 
					});
					$env.append(presentation).append(title);

					var prevServTypeId = -1;
					lemon.each(api.env.servSortEsc(envGroup.serv), function(serv, k) {
						var blankNote = lemon.isBlank(serv.note);
						var servGroup = api.getInterfGroup(serv.type.id);
						if (!blankNote && prevServTypeId != serv.type.id) {
							var miniG = [
								'<li role="presentation" class="dropdown-header"><h5>',
								lemon.repeat('&nbsp;', 2) + servGroup.name,
								'</h5></li>'
							].join('');
							$env.append(miniG);
							prevServTypeId = serv.type.id;
						}
						
						var servName = (blankNote ? servGroup.name : (lemon.repeat('&nbsp;', 5) + serv.note));
						var liTitle = servGroup.name + (blankNote ? '' : (' - ' + serv.note));
						var href = $(document.createElement('a'));
						if (serv.asDefault && 1 === serv.asDefault) {
							href.attr({id: 'default_env'});
						}
						href.click(function() {
							lemon.setEnv(serv.interf);
							api.env.change(serv.interf);
						});
						href.append('<p class="text-' + (isProduct ? 'warning' : 'info') + '">' + lemon.repeat('&nbsp;', 2) + servName + '</p>');
						var aEnv = $(document.createElement('li')).attr({
							title : liTitle
						}).append(href);
						$env.append(aEnv);
					});

					$env.append('<li>' + lemon.repeat('&nbsp;', 80) + '</li>');
				});

				$('#default_env').click();
			},
			change: function(interf) {
				var env = api.env.which(interf);
				var desc = env.desc + '  ' + env.type.name + (lemon.isBlank(env.note) ? '' : (' - ' + env.note));
				switch(env.env) {
				case 'TEST': 
					api.msg('success', desc , interf);
					break;
				case 'PRODUCT':
					api.msg('danger', desc, interf)
						.append('&nbsp;&nbsp;&nbsp;&nbsp;<strong>Danger !!!</strong>');
					break;
				}
				if ($('#request_url').length) {
					$('#request_url').text(api.nav.humanreadRequest());
				}
			},
			isProduct: function(interf) {
				return api.env.is(interf, 'PRODUCT');
			},
			is: function(interf, envEnum, envType) {
				return envEnum === (api.env.which(interf || lemon.getEnv(), envType) || {env: ''}).env;
			},
			which: function(interf, envType) {
				var result = {};
				lemon.each(api.preference.service(), function(v, k) {
					lemon.each(v.serv, function(v1, k1) {
						if (v1.interf === interf) {
							var tmp = {
								env: v.env,
								desc: v.desc,
								type: api.getInterfGroup(v1.type.id),
								interf: v1.interf,
								note: v1.note,
								params: v1.params,
								id: v1.id,
								request: v1.request
							};
							if (lemon.isUndefined(envType)) {
								result = tmp;
								return false;
							} else if (envType === tmp.type.id) {
								result = tmp;
								return false;
							}
						}
					});
				});
				return result;
			}
		},
		cmd: {
			render: function() {
				var $cmd = $('#which_api'); $cmd.empty();
				lemon.each(api.preference.interf(), function(group, k) {
					var title = [
						'<li role="presentation" class="dropdown-header"><h4>',
						'<span class="label label-info">' + group.name + '</span>',
						'</h4></li>'
						].join('');
					
					var presentation = $(document.createElement('li')).attr({
						role:'presentation', 
						class:'divider' 
					});
					$cmd.append(presentation).append(title);

					lemon.each(api.preference.defines().items, function(item, k) {
						if (group.id === item.type.id) {
							var dropItem = [
								'<h5>' + item.api + '</h5>',
								'<h6 class="text-muted" style="width:200px;">' + item.desc + '</h6>'
							].join('');
							
							var href = $(document.createElement('blockquote')).attr({
								'style': 'width:300px;',
								'data-container': 'body',
								'data-toggle': 'popover',
								'data-placement': 'right',
								'data-content': api.showNote(item.note || '') 
									+ '<pre style="width:500px;background-color:#ffffff;">' + lemon.json.highlight(item.request) + '</pre>',
								title: item.api + ' ' + item.desc
							}).append(dropItem);

							href.click(function() {
								lemon.setApi(item.api);
								api.requ(lemon.json(api.getAPIDefaultVal(item.api, item.request)));
							});

							var anApi = $(document.createElement('li')).append(href);
							$cmd.append(anApi);
						}
					});
				});

				$('#which_api blockquote').hover(function(){  
					$(this). addClass('block-grey');   
				},function(){  
					$(this). removeClass('block-grey');   
				});
			}
		},
		mod: {
			render: function() {
				$('#modal_tpl').on('show.bs.modal', function (event) {
				  	var button = $(event.relatedTarget);
				  	var modal = $(this); modal.empty();
				  	api.mod.currentTriggerId = button.data('element');
				  	var heightOffset = 13;
				  	
				  	if ('both' == api.mod.currentTriggerId) {
				  		/* var zoominRequest = $(document.createElement('textarea')).attr({
						  	id: 'edit-area-requ'
						}).css({
						  	height: document.body.clientHeight - heightOffset,
							width: document.body.clientWidth / 2
						}).text(api.requ());
						
				  		var zoominResponse = $(document.createElement('textarea')).attr({
						  	id: 'edit-area-resp'
						}).css({
						  	height: document.body.clientHeight - heightOffset,
							width: document.body.clientWidth / 2
						}).text(api.resp()); */

				  		var h = document.body.clientHeight - heightOffset;
				  		var w = document.body.clientWidth / 2;
				  		
				  		var html = [
					  			'<div class="row">',
								'<div class="col-md-6">',
								'<textarea id="edit-area-requ" style="border:0px solid #ffffff;height:' + h + 'px;width:' + w + 'px">' + api.requ() + '</textarea>',
								'</div>',
								'<div class="col-md-6" style="padding-left: 0px;">',
								'<textarea id="edit-area-resp" style="border:0px solid #ffffff;height:' + h + 'px;width:' + w + 'px">' + api.resp() + '</textarea>',
								'</div>',
								'</div>'
							].join('');
						modal.append(html);

						if (!after.styled) {
							api.nav.dblclick('#edit-area-requ');
						}
						api.nav.view('#edit-area-requ');
						if (!after.styled) {
							api.nav.dblclick('#edit-area-resp');
						}
						api.nav.view('#edit-area-resp');
					} else {
						var theVal1 = '';
						if ('#request' == api.mod.currentTriggerId) {
							theVal1 = api.requ();
						} else if ('#response' == api.mod.currentTriggerId) {
							theVal1 = api.resp();
						}
						
					  	var zoomin = $(document.createElement('textarea')).attr({
						  	id: 'edit-area'
						}).css({
							border: '0px solid #ffffff',
						  	height: document.body.clientHeight - heightOffset,
							width: document.body.clientWidth
						}).text(theVal1);
						modal.append(zoomin);

						api.nav.dblclick('#edit-area');
						api.nav.view('#edit-area');
					}
				}).on('hide.bs.modal', function(event) {
					if ('both' == api.mod.currentTriggerId) {
						api.requ($('#edit-area-requ').val());
						api.resp($('#edit-area-resp').val());
						if (!after.styled) {
							api.nav.view('#request', true);
							api.nav.view('#response', true);
						}
					} else {
						if ('#request' == api.mod.currentTriggerId) {
							api.requ($('#edit-area').val());
						} else if ('#response' == api.mod.currentTriggerId) {
							api.resp($('#edit-area').val());
						}
					}
				});
			},
			currentTriggerId: null
		}
	};

	//$(function(){ api.initialize(); });
	
	var after = after || {
		styled: false,
		request: null,
		response: null,
		
		initialize: function() {
			after.behavious();
			after.styled = true;
		},

		behavious: function() {
			var leftId = '#view_left', rightId = '#view_right';
			var leftHtml = $(leftId).html(), rightHtml = $(rightId).html();
			$(leftId).html(leftHtml);
			$(rightId).html(rightHtml);
			after.request = after.mirror('#request');
			after.response = after.mirror('#response');
			
			$('[data-element="#request"],[data-element="#response"]')
				.removeAttr('data-target')
				.click(function() {
					var triggerId = $(this).attr('data-element');
					switch (triggerId) {
					case '#request': after.rich.fullscreenTgl(after.request); break;
					case '#response': after.rich.fullscreenTgl(after.response); break;
					}
				}
			);

			$('.col-md-6 .panel-heading').attr({title: ''});
		},
		mirror: function(elId, options) {
			options = options || {};
			var rich = CodeMirror.fromTextArea(lemon.query(lemon.startIf(elId, '#')), lemon.extend({
				lineNumbers: false,
				matchBrackets: true,
				theme: 'lemon',
				styleActiveLine: false,
				readOnly: false,
				mode: "application/ld+json",
				autoCloseBrackets: true,
				lineWrapping: true,
				foldGutter: true,
				content: '',
				gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
				  	extraKeys: {
				    	"F11": function(cm) {
				    		after.rich.fullscreenTgl(cm);
				   		},
				    	"Esc": function(cm) { 
					    	after.rich.fullscreenTgl(cm, false) 
					    },
				    	"Ctrl-J": "autocomplete",
				    	"Ctrl-Q": function(cm){ 
					    	cm.foldCode(cm.getCursor()); 
					    }
				  	}
				}, options)
			);

			rich.setSize(options.width || null, options.height || 435);
			rich.on('inputRead', function(cm, changeObj) {
				after.rich.fmt(cm);
			});
			
			return rich;
		},
		rich: {
			fullscreenTgl: function(cm, full) {
				cm.setOption("fullScreen", lemon.isUndefined(full) ? !cm.getOption("fullScreen") : full);
			},
			fmt: function(cm) {
				var cursor = cm.getCursor();
				try {
					cm.setValue(lemon.json(cm.getValue()));
				} catch (e) {
					lemon.warn(e, 'format error.');
				}
				cm.setCursor(cursor);
			}
		}
	};

	var config = {
		history: {
			//keep history size less than 0 unlimit
			max: -1,
			pageSize: 2
		},
		request: {
			//1 wrap request data into a parameter ('paramName' value), 2 using lemon.getUrl eg: ?a=1&b=2
			type: 1,
			paramName: 'data'
		}
	};

	var interf = {
		manager: {
			id: 1,
			name: "Manager API"
		},
		appapi: {
			id: 2,
			name: "App API"
		},
		enterprise: {
			id: 3,
			name: "Enterprise API"
		},
		rpbrepayment: {
			id: 4,
			name: "Rpb Repayment API"
		}
	};

	var definedServs = [
	    {
		    env: 'TEST',
		    desc: "Test Environment",
		    serv: [
				{
					id: 1001,
					type: interf.manager,
					interf: "http://192.168.2.151:8080/rpd-manager/xv1.rp",
					note: "2.151",
					params: {
						'admin_token': '9VHmAsYNPUDCO0Il6a4Yec9VHmAsYNPUBHw9G'
					},
					asDefault: 1	//
				},
				{
					id: 1002,
					type: interf.manager,
					interf: "http://rpdapp.51test.top:8080/rpd-manager/xv1.rp",
					note: "51test.top",
					params: {
						'admin_token': '9VHmAsYNPUDCO0Il6a4Yec9VHmAsYNPUBHw9G'
					}
				},
				{
					id: 1009,
					type: interf.appapi,
					interf: "http://10.0.40.101:9000/51rp/rpdservice/xv2.htm",
					note: "51test.top xv2"
				},
				{
					id: 1003,
					type: interf.appapi,
					interf: "http://10.0.40.101:9000/51rp/rpdservice/xv3.htm",
					note: "51test.top xv3"
				},
				{
					id: 1008,
					type: interf.appapi,
					interf: "http://192.168.2.151:8080/rpdservice/xv2.htm",
					note: "2.151 xv2"
				},
				{
					id: 1004,
					type: interf.appapi,
					interf: "http://192.168.2.151:8080/rpdservice/xv3.htm",
					note: "2.151 xv3"
				},
				{
					id: 1005,
					type: interf.enterprise,
					interf: "http://192.168.2.151:8080/rpdservice/ev1web.htm",
					note: "2.151"
				},
				{
					id: 1006,
					type: interf.rpbrepayment,
					interf: "http://192.168.2.151:8080/rpdservice/cr1.htm",
					note: "2.151"
				},
				{
					id: 1007,
					type: interf.rpbrepayment,
					interf: "https://10.0.40.101:443/51rp/rpdservice/cr1.htm",
					note: "51test.top"
				}

			]
		},
		{
		    env: 'PRODUCT',
		    desc: "Product Environment",
		    serv: [
				{
					id: 8001,
					type: interf.manager,
					interf: "https://www.u51.com/rpd-manager/xv1.rp",
					params: {
						'admin_token': '9VHmAsYNPUDCO0Il6a4Yec9VHmAsYNPUBHw9G'
					}
				},
				{
					id: 8002,
					type: interf.appapi,
					interf: "https://www.u51.com/51rp/rpdservice/xv3.htm"
				},
				{
					id: 8003,
					type: interf.enterprise,
					interf: "https://www.u51.com/51rp/rpdservice/ev1web.htm"
				},
				{
					id: 8004,
					type: interf.rpbrepayment,
					interf: "https://www.u51.com/51rp/rpdservice/cr1.htm"
				}
			]
		}
	];

	var definedAPIs = {
		items: [
			 {
				 api:"M000913",
				 desc:"Query User",
				 note:"",
				 type: interf.manager,
				 request:{"cmd":"M000913","userId":"","token":"","version":"1.0.0","data":{"name":"","mobile":""}}
			 },
			 {
				 api:"M000908",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request:{"cmd":"M000908","userId":"","token":"","version":"1.0.0"}
			 },
			 {
				 api:"M000909",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request:{"cmd":"M000909","userId":"","token":"","version":"1.0.0","data":{"pn":"1","ps":"30","start":"20150526101010","end":"20150527101010","account_type":"SAVING_POT"}}
			 },
			 {
				 api:"M000915",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000915","userId":"","token":"","version":"1.0.0","data":{"user_id":"user id","order_no":"order no"}}
			 },
			 {
				 api:"M000920",
				 desc:"sinacardId",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000920","userId":"","token":"","version":"1.0.0","data":{"user_id":"ID","sina_card_id":"ID"}}
			 },
			 {
				 api:"M000900",
				 desc:": ;: ",
				 note:"",
				 type: interf.manager,
				 request:{"cmd":"M000900","userId":"","token":"","version":"1.0.0","data":{"tenderId":"ID","recordId":"OperatorRecordId"}}
			 },
			 {
				 api:"M000901",
				 desc:": OperatorRecord",
				 note:"",
				 type: interf.manager,
				 request:{"cmd":"M000901","userId":"","token":"","version":"1.0.0","data":{"recordId":"OperatorRecordId"}}
			 },
			 {
				 api:"M000902",
				 desc:"hostPayBack,",
				 note:"",
				 type: interf.manager,
				 request:{"cmd":"M000902","userId":"","token":"","version":"1.0.0","data":{"recordId":"OperatorRecordId"}}
			 },
			 {
				 api:"M000903",
				 desc:"hostCollectBack,",
				 note:"",
				 type: interf.manager,
				 request:{"cmd":"M000903","userId":"","token":"","version":"1.0.0","data":{"recordId":"OperatorRecordId"}}
			 },
			 {
				 api:"M000904",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000904","userId":"","token":"","version":"1.0.0","data":{ "type":"1 cellRepaymentService.createRepayment, 2 cellRepaymentService.doRepayment, 3 enterpriseEnsureAccountService.hostCollect, 4 enterpriseBasicAccountService.companyEarn", "plan_id":"TenderPlanId"}}
			 },
			 {
				 api:"M000905",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000905","userId":"","token":"","version":"1.0.0","data":{"withdraw_id":"withdrawId","operator_auto_id":"operatorAutoId"}}
			 },
			 {
				 api:"M000906",
				 desc:"hostCollectFail,",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000906","userId":"","token":"","version":"1.0.0","data":{"recordId":"OperatorRecordId"}}
			 },
			 {
				 api:"M000907",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000907","userId":"","token":"","version":"1.0.0","data":{"amount":"","type":"1 , 2 Amount, 3  Amount","way":"0 T+1T+2, 1 "}}
			 },
			 {
				 api:"M000910",
				 desc:"hostCollectFail,",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000910","userId":"","token":"","version":"1.0.0","data":{"recordId":"OperatorRecordId"}}
			 },
			 {
				 api:"M000911",
				 desc:"hostCollect,,",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000911","userId":"","token":"","version":"1.0.0","data":{"user_id":"ID","money":"","reason":"","recordId":"OperatorId"}}
			 },
			 {
				 api:"M000912",
				 desc:"hostPay,,",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000912","userId":"","token":"","version":"1.0.0","data":{"user_id":"ID","money":"","reason":"","recordId":"OperatorId"}}
			 },
			 {
				 api:"M000914",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000914","userId":"0","token":"","version":"1.0.0","data":{"user_id":"","amount":"","tender_id":""}}
			 },
			 {
				 api:"M000916",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000916","userId":"","token":"","version":"1.0.0","data":{"recordId":"OperatorRecordId"}}
			 },
			 {
				 api:"M000917",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000917","userId":"","token":"","version":"1.0.0","data":{"pn":"page no","ps":"page size","page_count":"0,0"}}
			 },
			 {
				 api:"M000918",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000918","userId":"","token":"","version":"1.0.0","data":{"pn":"page no","ps":"page size", "user_id":"ID()","pot_amount":"()","rpb_amount":"()","name":"()"}}
			 },
			 {
				 api:"M000919",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000919","userId":"","token":"","version":"1.0.0","data":{"statistics_id":"ID"}}
			 },
			 {
				 api:"M000921",
				 desc:",",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000921","userId":"","token":"","version":"1.0.0","data":{"recordId":"RecordAutoId","collectRecordId":"RecordAutoId"}}
			 },
			 {
				 api:"M000922",
				 desc:",",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000922","userId":"","token":"","version":"1.0.0","data":{"recordId":"RecordAutoId"}}
			 },
			 {
				 api:"M000923",
				 desc:" Pre  pay",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000923","userId":"","token":"","version":"1.0.0","data":{"recordId":"RecordAutoId"}}
			 },
			 {
				 api:"M000924",
				 desc:"",
				 note:[
					'{"type":1,"recordId":"RecordID","transferId":""}',
					'{"type":2,"recordId":"RecordID"}',
					'{"type":3,"recordId":"RecordID"}',
					'{"type":4,"recordId":"RecordID"}'
				 	],
				 type: interf.manager,
				 request: {"cmd":"M000924","userId":"","token":"","version":"1.0.0","data":{"type":""}}
			 },
			 {
				 api:"M000031",
				 desc:"51ID",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000031","userId":"","token":"","version":"1.0.0","data":{"user_id":"user id","name":"name"}}
			 },
			 {
				 api:"M000011",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: { "cmd": "M000011", "version": "1.0.0", "data": "" }
			 },
			 {
				 api:"M000925",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000925","userId":"","token":"","version":"1.0.0","data":{"auto_id":"autoid"}}
			 },
			 {
				 api:"M000926",
				 desc:": ",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000926","userId":"","token":"","version":"1.0.0","data":{"type":"1, 2, 3, 4","planId":"ID","recordId":0}}
			 },
			 {
				 api:"M000927",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000927","userId":"","token":"","version":"1.0.0","data":{"user_id":"userId","show_detail":"1 show","date":""}}
			 },
			 {
				 api:"M000928",
				 desc:"UserId",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000928","userId":"Id","token":"TOKEN","version":"1.0.0","data":{"recordId":"OperatorAutoId"}}
			 },
			 {
				 api:"M000929",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000929","userId":"","token":"","version":"1.0.0","data":{"type":"1, 2, 3, 4 5  6  7  8 ","operatorId":"ID","amount":"10.00"}}
			 },
			 {
				 api:"M000930",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000930","userId":"","token":"","version":"1.0.0","data": {"start":"yyyy-MM-dd HH:mm:ss","end":"yyyy-MM-dd HH:mm:ss","notice":"","cmds":" ","banks":" ","type":"0 , 1 "}}
			 },
			 {
				 api:"M000931",
				 desc:"()",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000931","userId":"","token":"","version":"1.0.0","data":{"recordId":""}}
			 },
			 {
				 api:"M000932",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000932","userId":"","token":"","version":"1.0.0","data":{"tender_id":"tenderId","type":"1 , 2 "}}
			 },
			 {
				 api:"M000933",
				 desc:", :M000927",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000933","userId":"","token":"","version":"1.0.0","data":{"pn":"page no","ps":"page size","page_count":"0,0"}}
			 },
			 {
				 api:"M000934",
				 desc:"",
				 note:[
					'{"type":1,"tempTransferAutoId":""}',
					'{"type":2,"recordId":"OperatorRecordAutoI"}',
					'{"type":3,"recordId":"OperatorRecordAutoId","tempTransferAutoId":""}',
					'{"type":4,"recordId":"OperatorRecordAutoId"}',
					'{"type":11Transfer,"tempUserAutoId":""}',
					'{"type":12Transfer,"tempUserAutoId":""}'
				 	],
				 type: interf.manager,
				 request: {"cmd":"M000934","userId":"","token":"","version":"1.0.0","data":{"type":""}}
			 },
			 {
				 api:"M000938",
				 desc:"",
				 note:[
					'{"type":1,"salaryPlanId":""}',
					'{"type":2,"recordId":"OperatorRecordAutoI"}',
					'{"type":3,"salaryPlanId":""}',
					'{"type":4,"recordId":"OperatorRecordAutoId"}'
				 	],
				 type: interf.manager,
				 request: {"cmd":"M000938","userId":"","token":"","version":"1.0.0","data":{"type":""}}
			 },
			 {
				 api:"M000939",
				 desc:"",
				 note:[
					'{"type":1,"statisticsId":""}',
					'{"type":2,"recordId":"OperatorRecordAutoI"}',
					'{"type":3,"statisticsId":""}',
					'{"type":4,"recordId":"OperatorRecordAutoId"}',
					'{"type":5,"day":"2015-07-30"}'
				 	],
				 type: interf.manager,
				 request: {"cmd":"M000939","userId":"","token":"","version":"1.0.0","data":{"type":""}}
			 },
			 {
				 api:"M000610",
				 desc:"ID",
				 note: "",
				 type: interf.manager,
				 request: {"cmd":"M000610","userId":"","token":"","version":"1.0.0", "data":{"uids":""}}
			 },
			 {
				 api:"M000935",
				 desc:"B2C,",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000935","userId":"","token":"","version":"1.0.0","data":{"company_id":"1","amount":""}}
			 },
			 {
				 api:"M000936",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000936","userId":"","token":"","version":"1.0.0", "data":{"money":"","type":"1 , 2 ","operator_id":"type 1ID, type 2OperatorRecordAutoId"}}
			 },
			 {
				 api:"M000937",
				 desc:" ",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000937","userId":"","token":"","version":"1.0.0", "data":{"type":"1, 2","id":"type 1, type 2ID  "}}
			 },
			 {
				 api:"M000940",
				 desc:",",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000940","userId":"","token":"","version":"1.0.0","data":{"company_id":"1","amount":""}}
			 },
			 {
				 api:"M000941",
				 desc:"-",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000941","userId":"","token":"","version":"1.0.0","data":{"transactionId":""}}
			 },
			 {
				 api:"M000942",
				 desc:"",
				 note:'business_type: 1 , 2 , 3 , 5 ',
				 type: interf.manager,
				 request: {"cmd":"M000942","userId":"","token":"","version":"1.0.0","data":{"business_type":"","business_id":""}}
			 },
			 {
				 api:"M000943",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000943","userId":"","token":"","version":"1.0.0"} 
			 },
			 {
				 api:"M000944",
				 desc:",",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000944","userId":"","token":"","version":"1.0.0","data":{"company_id":"1","amount":""}} 
			 },
			 {
				 api:"M000945",
				 desc:"PushMethod",
				 note: [
					"method (MethodEnum): 1 , 2 , 3 , 4 , 5 , 6 ",
					"8 , 10, , 11 , 12 , 13 ",
					"14 , 15 , 16 , 17 , 18 , 19 ",
					"20 , 35 , 36 , 37 ",
					"38 , 39 "
				 	],
				 type: interf.manager,
				 request: {"cmd":"M000945","userId":"","token":"","version":"1.0.0","data":{"method":"","operator_auto_id":"","args":""}} 
			 },
			 {
				 api:"M000946",
				 desc:",",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000946","userId":"","token":"","version":"1.0.0","data":{"amount":""}} 
			 },
			 {
				 api:"M000947",
				 desc:",",
				 note:"M000941 ",
				 type: interf.manager,
				 request: {"cmd":"M000947","userId":"","token":"","version":"1.0.0","data":{"operator_auto_id":""}} 
			 },
			 {
				 api:"M000948",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000948","userId":"","token":"","version":"1.0.0","data":{"refund_id":"","state":"0 , 1 , 2 "}} 
			 },
			 {
				 api:"M000951",
				 desc:"",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000951","userId":"","token":"","version":"1.0.0","data": {"company_balance_auto_id":"","trans_txt":"","trans_party":""}} 
			 },
			 {
				 api:"M000952",
				 desc:"(,,)",
				 note:"",
				 type: interf.manager,
				 request: {"cmd":"M000952","userId":"","token":"","version":"1.0.0"} 
			 },
			 {
				 api:"M000953",
				 desc:"AsyncQueue",
				 note: {
					 type: {
						1: 'addSyncQueue(recordType, recordId, createTime)',
						2: 'addSyncQueueDelay(recordType, recordId, createTime, minutes)',
						3: 'removeSyncQueue(recordType, recordId)',
						4: 'getSyncQueue(offset, count, createTime)'
					 },
					 'record_type': 'see OperatorRecordEnums',
					 'create_time': '',
					 minutes: '(), type2'
			     },
				 type: interf.manager,
				 request: {"cmd":"M000953","userId":"","token":"","version":"1.0.0", "data":{"type":"","record_id":"","record_type":"","minutes":"","create_time":"","offset":"","count":""}}
			 },
			 {
				 api:"M000954",
				 desc:"lockPayPasswd",
				 note: 'type: 1 get, 2 set, 3 remove',
				 type: interf.manager,
				 request: {"cmd":"M000954","userId":"","token":"","version":"1.0.0", "data":{"type":""}}
			 },
			 {
				 api:"R000001",
				 desc:"",
				 note:"",
				 type: interf.rpbrepayment,
				 request: {"cmd":"R000001","userId":"","token":"","version":"1.0.0","data":{"user_name":""}}
			 },
			 {
				 api:"R000002",
				 desc:"",
				 note:"",
				 type: interf.rpbrepayment,
				 request: {"cmd":"R000002","userId":"","token":"","version":"1.0.0"}
			 },
			 {
				 api:"R000003",
				 desc:"",
				 note:"",
				 type: interf.rpbrepayment,
				 request: {"cmd":"R000003","userId":"","token":"","version":"1.0.0","data": {"bill_id":"ID","credit_acco":"","amount":"","bank_id":"ID","trade_pwd":"","user_name":""}}
			 },
			 {
				 api:"R000004",
				 desc:"",
				 note:"",
				 type: interf.rpbrepayment,
				 request: {"cmd":"R000004","userId":"","token":"","version":"1.0.0","data":{"order_no":""}}
			 },
			 {
				 api:"R000005",
				 desc:"() ",
				 note:"",
				 type: interf.rpbrepayment,
				 request: {"cmd":"R000005","userId":"","token":"","version":"1.0.0","data":	{"realname":"","identity":"","card_no":"","mobile":"","provice":"","city":"","card_type":"(),DEBITCREDIT: ()","bank_code":"()"}}
			 },
			 {
				 api:"R000006",
				 desc:"() ",
				 note:"",
				 type: interf.rpbrepayment,
				 request: {"cmd":"R000006","userId":"","token":"","version":"1.0.0","data":{"order_no":"","ticket":"ticket","sms_code":""}}
			 }

		]
	};

</script>
</body>
</html>